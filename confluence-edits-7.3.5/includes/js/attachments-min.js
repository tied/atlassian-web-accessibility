define("confluence/attachments",["ajs","confluence/templates","confluence/api/ajax","confluence/api/constants","confluence/message-controller"],function(e,t,n,o,a){"use strict";var i,r={showOlderVersions:function(e){e(".attachment-history a").click(function(t){var n=e(this).parents("table.attachments"),o=e(this).parents("tr:first")[0].id.substr(11),a=e(".history-"+o,n);return e(this).hasClass("icon-section-opened")?e(this).toggleClass("icon-section-opened").attr("aria-expanded","false").toggleClass("icon-section-closed"):e(this).hasClass("icon-section-closed")&&e(this).toggleClass("icon-section-closed").attr("aria-expanded","true").toggleClass("icon-section-opened"),a.toggleClass("hidden"),t.stopPropagation(),!1})}},s=!1;function c(t){clearTimeout(i),s&&(e.log("Preventing submit due to recent form submission."),t.preventDefault()),s=!0,i=setTimeout(function(){s=!1},2e3)}return{component:r,initialiser:function(i){i("#upload-attachments").on("submit",c);var s=i("#more-attachments-link");s.click(function(e){return i(".more-attachments").removeClass("hidden"),s.addClass("hidden"),e.stopPropagation(),!1}),r.showOlderVersions(i);var l=t.Attachments;function m(e,t){return i(e).parents("["+t+"]").attr(t)}function u(e){return m(e,"data-attachment-filename")}function d(t){return e.ConfluenceDialog({width:600,height:200,id:t})}function h(t,o,r){var s=d("attachment-removal-confirm-dialog");s.addHeader(o),s.addPanel("",r),s.addSubmit(e.I18n.getText("ok"),function(){!function(e,t,o,a){t=t||{},n.ajax({type:"POST",url:e,data:t,success:o,error:a})}(t,null,function(){location.reload(!0)},function(t){var n=[];if(n.push(a.parseError(t)),t.responseText){var o=i.parseJSON(t.responseText);o.actionErrors&&(n=o.actionErrors)}var r=d("attachment-removal-error-dialog");r.addHeader(l.removalErrorTitle()),r.addPanel("",l.removalErrorBody({messages:n})),r.addButton(e.I18n.getText("close.name"),function(){location.reload(!0)}),r.show(),r.updateHeight(),s.remove()})}),s.addCancel(e.I18n.getText("cancel.name"),function(){s.remove()}),s.show()}function f(e,t){return o.CONTEXT_PATH+e+t}i(".removeAttachmentLink").click(function(){return r.showRemoveAttachmentConfirmDialog(this),!1}),i(".removeAttachmentLinkVersion").click(function(e){var t;return h(f("/json/removeattachmentversion.action",this.search),l.versionRemovalConfirmationTitle(),l.versionRemovalConfirmationBody({filename:u(this),version:(t=this,m(t,"data-attachment-version"))})),!1}),r.showRemoveAttachmentConfirmDialog=function(e){h(f("/json/removeattachment.action",e.search),l.removalConfirmationTitle(),l.removalConfirmationBody({filename:u(e)}))}},submitHandler:c}}),require("confluence/module-exporter").safeRequire("confluence/attachments",function(e){"use strict";var t=require("ajs");t.Attachments=e.component,t.toInit(e.initialiser)});