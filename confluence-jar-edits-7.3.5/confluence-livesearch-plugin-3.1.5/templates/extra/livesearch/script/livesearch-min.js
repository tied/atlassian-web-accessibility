AJS.toInit(function(d){var f={userinfo:"icon-user",personalspace:"icon-personal-space"};var c=function(g){return g.replace(/&amp;/g,"&").replace(/&quot;/g,'"').replace(/&#39;/g,"'").replace(/&lt;/g,"<").replace(/&gt;/g,">")};var a=function(g){var h={title:c(g.title),link:[{type:"text/html",rel:"alternate",href:AJS.contextPath()+decodeURI(g.url)}],type:g.contentType};if(g.searchResultContainer){h.space={name:g.searchResultContainer.name}}if(g.metadata&&g.metadata.cssClass){h.livesearchIconClass=g.metadata.cssClass}var i=g.contentType;if(i&&f[i]){h.livesearchIconClass=f[i]}if(g.bodyTextHighlights){h.bodyTextHighlights=c(g.bodyTextHighlights)}return h};var b=function(g,h){g.after(g.clone().attr("class","additional").html(h));g.parent().addClass("with-additional")};var e=function(i,g,h){return[{title:h,link:[{type:"text/html",rel:"alternate",href:AJS.params.baseUrl+"/dosearchsite.action?queryString="+i+"&where="+g}],iconClass:"search-for"}]};d(".search-macro-query input").each(function(){var m=d(this),i=m.closest("form"),h=i.find(".aui-icon.aui-iconfont-search"),j=i.find("input[name='where']").val(),g=i.find("input[name='additional']").val(),l=i.find("input[name='labels']").val(),k=i.find("input[name='contentType']").val();m.quicksearch("/rest/searchv3/1.0/search",null,{minLengthForGetData:3,dropdownPlacement:function(p){var n=i.siblings(".aui-dd-parent");var o=i.parent(".search-macro").position();n.css({position:"absolute",top:o.top+m.outerHeight(),width:m.outerWidth()});p.width(m.outerWidth());n.append(p)},makeParams:function(n){return{queryString:n,where:j,labels:l?l.split(","):undefined,type:k,pageSize:5,highlight:false,sessionUuid:"0-0-0-0"}},makeRestMatrixFromData:function(p){var n=[],o=m.val();if(p.results&&p.results.length){n=_.map(p.results,a);return[n,e(o,j,AJS.I18n.getText("confluence.extra.livesearch.searchfor",o))]}else{n=e(o,j,AJS.I18n.getText("confluence.extra.livesearch.no.results",o));return n?[n]:[]}},dropdownPostprocess:function(n){AJS.$("a",n).each(function(){var s=d(this),p=s.find("span"),t=s.parent("li"),o=AJS.dropDown.getAdditionalPropertyValue(p,"restObj");if(o&&o.livesearchIconClass){var r=AJS.dropDown.getAdditionalPropertyValue(p,"iconClass");s.removeClass(r);p.addClass(o.livesearchIconClass)}if(g==="space name"){var q=AJS.dropDown.getAdditionalPropertyValue(p,"spaceName");if(q&&!s.is(".content-type-spacedesc")){b(s,q)}}else{if(g==="page excerpt"){if(o.bodyTextHighlights){b(s,o.bodyTextHighlights)}}}t.attr("data-content-type",o.type)})},ajsDropDownOptions:{className:"search-macro-dropdown"}});m.on({"quick-search-loading-start":function(){h.addClass("aui-icon-wait").removeClass("aui-iconfont-search")},"quick-search-loading-stop":function(){h.removeClass("aui-icon-wait").addClass("aui-iconfont-search")}})})});