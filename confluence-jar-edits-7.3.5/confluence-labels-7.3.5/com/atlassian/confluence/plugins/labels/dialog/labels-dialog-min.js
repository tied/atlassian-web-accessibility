define("confluence-labels/labels/dialog/labels-dialog","confluence/templates ajs confluence-labels/labels/labels confluence/meta confluence/legacy jquery".split(" "),function(b,c,d,i,o,e){if(b.Labels){var g={},f=null,k=function(){e("#"+f.id).find(".label-list").removeClass("editable");f.hide();return false};g.bindOpenDialog=function(d){d.click(function(a){a.preventDefault();a=e(a.target).closest(".labels-section-content");a.length?g.openDialog(a):g.openDialog()})};g.openDialog=function(h){var a,l,
j;if(!f){f=c.ConfluenceDialog({width:600,height:250,id:"edit-labels-dialog",onCancel:k});f.addHeader(c.I18n.getText("labels.name"));f.addPanel("Label Editor",b.Labels.dialog());f.addCancel(c.I18n.getText("close.name"),k);f.addHelpText(c.I18n.getText("labels.dialog.shortcut.tip"),{shortcut:"l"});f.popup.element.find(".dialog-title").prepend(b.Labels.helpLink());e("#add-labels-form").submit(function(a){var b=e("#labels-string");a.preventDefault();a=e("#dialog-label-list");d.addLabel(b.val(),a.attr("entityid"),
a.attr("entitytype")).always(function(){e("#labels-autocomplete-list").find(".aui-dropdown").addClass("hidden");b.focus()})});d.bindAutocomplete()}if(h){a=h.attr("entityid");h=h.attr("entitytype")}else{h=i.get("content-type");a=o.Editor.Drafts.isNewContent()?i.get("draft-id"):i.get("page-id")}l=d.routes.list(h,a);j=e("#dialog-label-list");j.attr("entityid",a);j.attr("entitytype",h);var m=function(){f.show();e("#labels-string").val("").focus();c.trigger("labels.dialog.open")},n=function(a){g.updateDialogLabelList(a.labels);
i.set("num-labels",a.labels.length);e("#rte-button-labels").trigger("updateLabel");m()};if(d.labelsAreNotPersisted(a)){a=d.getLabelsInputField();a=d.parseLabelStringToArray(a);n({labels:a})}else e.ajax({url:l,cache:false,success:function(a){var b=[];e.each(a.labels,function(a,d){b.push(d.name)});d.setLabelsInputField(b.join(" "));n(a)},error:function(){d.setLabelError("Unable to fetch current labels from the server.");m()}});e("#dialog-label-list").attr("data-ready","true")};g.updateDialogLabelList=
function(c){var a=e("#dialog-label-list");if(a.length){e.each(c,function(a,b){b.link=d.getLabelLink(i.get("space-key"),b)});a.html(b.Labels.dialogLabelList({labels:c,editable:true}))}};return g}});
require("confluence/module-exporter").safeRequire("confluence-labels/labels/dialog/labels-dialog",function(b){var c=require("ajs");c.Labels.bindOpenDialog=b.bindOpenDialog;c.Labels.openDialog=b.openDialog;c.Labels.updateDialogLabelList=b.updateDialogLabelList;c.toInit(function(d){d(document).on("click","#rte-button-labels",function(){b.openDialog()});d(".show-labels-editor").click(function(c){c.preventDefault();c=d(c.target).closest(".labels-section-content");b.openDialog(c)})})});