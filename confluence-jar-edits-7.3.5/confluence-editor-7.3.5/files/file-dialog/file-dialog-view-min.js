define("confluence-editor/files/file-dialog/file-dialog-view","backbone ajs confluence/templates underscore jquery document window".split(" "),function(j,e,k,f,d,i,l){return j.View.extend({dialogId:"insert-image-dialog",ESC_KEY_CODE:27,width:840,height:530,initialize:function(a){this.urlExternalImg="";this.selectItems=[];this.submitCallback=a.submitCallback;this.cancelCallback=a.cancelCallback;this.beforeShowListeners=a.beforeShowListeners;this.panelComponents=a.panelComponents},render:function(){this._createDialog();
this.clearSelection();d(i).on("keydown.insert-image",f.bind(this._onNavigationByKey,this));return this},_createDialog:function(){var a=new e.Dialog(this.width,this.height,this.dialogId),m=e.I18n.getText("file.browser.insert.title"),b=e.I18n.getText("image.browser.insert.button");this.dialog=a;a.addHeader(m);a.addButton(b,f.bind(this._submitDialog,this),"insert");a.addCancel(e.I18n.getText("close.name"),f.bind(this._killDialog,this));this.el=a.popup.element;this.$el=d(this.el);this.baseElement=this.el;
this.$el.attr("data-tab-default","0");this.$insertButton=this.$el.find(".dialog-button-panel .insert");d("#"+this.dialogId+" .dialog-components .dialog-title").prepend(k.File.helpLink());this.$el.find(".dialog-button-panel").append(d("<div></div>").addClass("dialog-tip").html(e.I18n.getText("insert.image.did.you.know")));this._createPanels();d(i).on("hideLayer",f.bind(function(c,b,d){if(b==="popup"&&d===a.popup){d.remove();this.teardown();typeof this.cancelCallback==="function"&&this.cancelCallback()}},
this));e.bind("remove.dialog",f.bind(function(a,b){b.dialog.id===this.dialog.id&&this.teardown()},this));a.show();return a},_createPanels:function(){var a=this;d.each(this.panelComponents,function(){this&&typeof this.createPanel==="function"&&this.createPanel(a)});e.debug(this.beforeShowListeners.length+" beforeShow listeners registered.");d.each(this.beforeShowListeners,function(){typeof this==="function"&&this()})},teardown:function(){d(i).unbind(".insert-image");d(".tipsy").remove();this.undelegateEvents()},
_killDialog:function(){this.dialog.remove();this.clearSelection();typeof this.cancelCallback==="function"&&this.cancelCallback()},_submitDialog:function(){var a={url:this.urlExternalImg,contentId:e.Meta.get("attachment-source-content-id"),selectItems:this.selectItems};this.dialog.remove();typeof this.submitCallback==="function"&&this.submitCallback(a)},setSelectItems:function(a){if(typeof a==="string"){this.urlExternalImg=a;this.selectItems=[]}else{this.urlExternalImg="";this.selectItems=a}a=this.selectItems.length>
0||this.urlExternalImg;if(this.$insertButton){this.$insertButton.prop("disabled",!a);this.$insertButton.attr("aria-disabled",!a)}},clearSelection:function(){this.setSelectItems([])},insert:function(){this.$insertButton&&(!this.$insertButton.is(":disabled")||!this.$insertButton.attr("aria-disabled"))&&this.$insertButton.click()},addPanel:function(a,d,b,c){var e=this.dialog.getPage(0).panel.length;this.dialog.addPanel(a,d,b,c);return e},getPanel:function(a){return this.dialog.getPanel(a)},_onNavigationByKey:function(a){if(!d("#"+
this.dialog.id).is(":hidden")){var e=this.dialog.getCurrentPanel().body,b=e.find(".attached-file");if(!(b.length===0||d(i.activeElement).is("input[type=text], select, button"))){var c=l.tinymce.VK;switch(a.which){case c.LEFT:case c.UP:case c.RIGHT:case c.DOWN:var f=a.which,g;g=b.filter(".current");g.length||(g=b.filter(".selected"));if(g.length){g=b.index(g);var j=b.length,h={};h[c.LEFT]=-1;h[c.RIGHT]=1;h[c.UP]=-4;h[c.DOWN]=4;c=g+(h[f]?h[f]:0);b=b.eq(c<0||c>=j?g:c)}else b=b.first();b.parent().find("li.attached-file.current").removeClass("current");
b.addClass("current");b.length&&e.find(".scroll-wrapper").simpleScrollTo(b);a.stopPropagation();return false;case c.SPACEBAR:e.find("li.attached-file.current").click();a.stopPropagation();return false;case c.ENTER:this.insert();a.stopPropagation();return false}}}}})});require("confluence/module-exporter").exportModuleAsGlobal("confluence-editor/files/file-dialog/file-dialog-view","Confluence.Editor.FileDialog.FileDialogView");