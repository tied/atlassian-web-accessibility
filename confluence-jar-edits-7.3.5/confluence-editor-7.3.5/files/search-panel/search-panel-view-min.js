define("confluence-editor/files/search-panel/search-panel-view","confluence-editor/files/file-item/file-item-model confluence-editor/files/file-list/file-list-view confluence-editor/files/file-list/file-list-collection confluence-editor/files/base-panel/base-panel-view confluence/templates confluence/meta confluence/defaults confluence/highlighter confluence/api/constants underscore ajs jquery".split(" "),function(n,h,i,d,j,e,k,l,m,f,g,c){return d.extend({id:"search",panelId:"",cssPanel:".search-panel",
cssContainer:"#searched-images",template:j.File.searchPanel,events:{"submit form":"_submit"},initialize:function(){d.prototype.initialize.call(this);this.context=null;this.collection=new i;this.fileListView=new h({collection:this.collection})},getPanel:function(){this.$el=c(this.template({spaceKey:e.get("space-key"),spaceName:e.get("space-name")}));this.el=this.$el[0];this.delegateEvents();return this.el},render:function(){this.fileListView.updateDialogContext(this.context);this.panelId=this.context.addPanel(g.I18n.getText("file.browser.search.title"),
this.getPanel(),"search-panel");this.fileListView.updatePanelContext({fileContainer:this.getContainer(),noFileMessage:g.I18n.getText("image.browser.search.no.attachments"),showContainerInfo:true})},_submit:function(a){a.preventDefault();a.stopPropagation();if(this._getQuery()){this.clearContainer();this.collection.reset();this._loadImages().then(f.bind(this._onSuccessLoadFiles,this),f.bind(this._onErrorLoadFiles,this))}},_loadImages:function(){var a=this.getForm().find(".search-space").val(),b=this._getQuery(),
b='(title ~ "'+b+'*" OR parent.title ~ "'+b+'*") AND type = attachment';a&&a!==""&&(b=b+(" AND space.key = "+a));return c.ajax({type:"GET",dataType:"json",url:m.CONTEXT_PATH+"/rest/api/search",data:{cql:b,expand:"content.version,content.container,content.space",limit:k.maxResults}})},_onSuccessLoadFiles:function(a){a=a.results.map(function(a){return a.content});this.fileListView.highlighter=new l(this._getQuery().split(" "));this.fileListView.resetFileList(a,{shouldClearSelection:true})},_onErrorLoadFiles:function(){var a=
this.getContainer();a.find(".loading-message").addClass("hidden");a.append(c("<p class='warning'>"+c(this.textErrorSearch).text()+"</p>"))},_getSearchText:function(){return c("input.search-image-text",this.getForm())},_getQuery:function(){return this._getSearchText().val()||""},focus:function(){this.collection.clearSelection();this._getSearchText().focus()}})});require("confluence/module-exporter").exportModuleAsGlobal("confluence-editor/files/search-panel/search-panel-view","Confluence.Editor.FileDialog.SearchPanelView");