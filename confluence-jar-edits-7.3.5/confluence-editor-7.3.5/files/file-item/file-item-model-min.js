define("confluence-editor/files/file-item/file-item-model","backbone confluence/legacy confluence/api/constants ajs underscore plupload".split(" "),function(f,c,g,d,h,e){return f.Model.extend({defaults:{id:-1,ownerId:-1,fileName:"",nonceUrl:"",isImage:false,isFilePlaceHolder:false,isSelect:false,thumbnailUrl:"",downloadUrl:""},initialize:function(){var a=this;this._findDownloadUrl();this._findThumbnailUrl();this.findMetadata();this.findVersion();this.findContainer();this.set("fileName",this.getFileName());
this.set("nonceUrl",this.getNonceUrl());this.set("isImage",this.isImage());this.set("isPreviewable",this.isPreviewable());this.get("isFilePlaceHolder")&&this.set("id",this.get("fileId"));this.listenTo(this,"change:link",function(){a.set("nonceUrl",a.getNonceUrl());a._findDownloadUrl()});this.set("iconAUIClass",this._parseFileNameToAuiIconClass(this.get("fileName")))},isImage:function(){return this.get("isImage")?true:!!this.get("thumbnailUrl")},isPreviewable:function(){return(this.get("niceType")||
"").toLocaleLowerCase()==="application/pdf"||this.isImage()},getFileName:function(){return this.get("fileName")||this.get("title")||""},getDestinationUrl:function(){return d.REST.wikiLink(this.attributes).destination},getNonceUrl:function(){var a=this.get("thumbnailUrl");if(a.indexOf("modificationDate")>=0)return a;var b=this.get("lastModifiedDate"),b=b?b.date:+new Date,b=encodeURIComponent(b);a&&(a=a+((a.indexOf("?")+1?"&":"?")+"nonce="+b));return a},getRelativeUrl:function(a){var b=a;if(!a)return a;
a.indexOf(c.getBaseUrl())===0&&(b=a.replace(c.getBaseUrl(),""));return g.CONTEXT_PATH+b},_findThumbnailUrl:function(){var a=this.get("_links");!this.get("thumbnailUrl")&&(a&&a.thumbnail)&&this.set("thumbnailUrl",this.getRelativeUrl(a.thumbnail))},_findDownloadUrl:function(){var a=this.get("_links");!this.get("downloadUrl")&&a&&this.set("downloadUrl",this.getRelativeUrl(a.download))},findMetadata:function(){var a=this.get("metadata");if(!this.get("contentType")&&a){this.set("niceType",a.mediaType);
this.set("contentType",a.mediaType)}},findVersion:function(){var a=this.get("version");!this.get("versionNumber")&&a&&this.set("versionNumber",a.number)},findContainer:function(){var a=this.get("container");if(a){this.get("ownerId")===-1&&this.set("ownerId",a.id);this.get("parentTitle")||this.set("parentTitle",a.title)}},_getFileExtension:function(a){return a.substr(a.lastIndexOf(".")+1)},_parseFileNameToAuiIconClass:function(a){a=typeof e!=="undefined"?e.mimeTypes[this._getFileExtension(a)]:"";return d.Confluence.FileTypesUtils.getAUIIconFromMime(a)}})});
require("confluence/module-exporter").exportModuleAsGlobal("confluence-editor/files/file-item/file-item-model","Confluence.Editor.FileDialog.FileItemModel");