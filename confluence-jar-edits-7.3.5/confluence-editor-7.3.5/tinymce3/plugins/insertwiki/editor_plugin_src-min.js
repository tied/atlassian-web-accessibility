define("confluence-editor/tinymce3/plugins/insertwiki/editor_plugin_src","jquery ajs confluence/legacy tinymce underscore confluence/api/constants".split(" "),function(e,b,g,i,t,p){var n=!b.DarkFeatures.isEnabled("editor.insert-wiki-markdown"),d={DEFAULT:null,HELP_REST_API:b.contextPath()+"/plugins/tinymce/helplink.action",WIKI:{CONFLUENCE:{val:"CONFLUENCE",label:b.I18n.getText("tinymce.confluence.conf_wikimarkup_confluence_label"),helpLink:"help.insert.wiki.markup",restApi:"/rest/tinymce/1/wikixhtmlconverter"},
MARKDOWN:{val:"MARKDOWN",label:b.I18n.getText("tinymce.confluence.conf_wikimarkup_markdown_label"),helpLink:"help.insert.wiki.markup.markdown",restApi:"/rest/tinymce/1/markdownxhtmlconverter"}}},q=new g.localStorageCacheManager("insert-wiki-markup-dialog");return{init:function(f,u){f.addCommand("InsertWikiMarkup",function(){var j={id:"insert-wiki-markup-dialog",content:n?g.Templates.InsertWiki.wikiMarkupDialog():g.Templates.InsertWiki.originalDefaultTempWikiMarkupDialog(),width:980,height:500,popup:false,
name:"confluence.conf_wikimarkup_desc"},v=b.Meta.get("content-id"),w=b.Meta.get("space-key");d.DEFAULT=d.WIKI[q.get("parser")||"CONFLUENCE"];var c={getElement:function(a){c[a]=c[a]||e(a);return c[a]}},k=null,l=function(){var a=c.getElement("#wiki-parser-selection-tool");return a.length?a.val():d.DEFAULT.val},r=function(a){a=a||{};a.setBusy&&f.windowManager.setBusy(j.id,true);e.ajax({type:"POST",contentType:"application/json; charset=utf-8",url:a.API,data:e.toJSON({wiki:a.textToConvert,entityId:v,
spaceKey:w}),dataType:"text",success:a.successCallback,error:a.errorCallback||function(a){b.logError(a)},timeout:7500})},x=function(a){var c=j.id,d=l();f.windowManager.setBusy(c,false);i.EditorManager.activeEditor.windowManager.close(c);if(n){b.trigger("analytics",{name:"insert-wiki-markup-dialog."+d});if(d==="MARKDOWN"){a=e(a);a.find("img").addClass("confluence-embedded-image");a=e("<div>").append(a.clone()).html()}}f.execCommand("mceInsertContent",false,a);i.each(f.dom.select("p > p"),function(a){try{f.dom.split(a.parentNode,
a)}catch(c){b.logError("insertwikimarkup - splitParas()",c)}})},y=function(a,c,d){f.windowManager.setBusy(j.id,false);a={warningMessage:i.EditorManager.activeEditor.getLang("confluence.conf_wikimarkup_errors"),exceptionMessage:c==="timeout"?i.EditorManager.activeEditor.getLang("confluence.conf_wikimarkup_timeout"):b.escapeHtml(c)+" : "+b.escapeHtml(d)};a=g.Templates.InsertWiki.wikiErrorSubDialog(a);i.EditorManager.activeEditor.windowManager.alert(a)},s=function(){var a=c.getElement("#insert-wiki-textarea"),
b=a.val();e.trim(b)?r({API:p.CONTEXT_PATH+d.WIKI[l()].restApi,textToConvert:b,successCallback:function(a){k.html(a)},errorCallback:function(){k.html(a.val())}}):k.html(b)},z=function(){var a=l();q.put("parser",a);c.getElement("#"+j.id).find(".dialog-help-link").load(d.HELP_REST_API,{linkUrlKey:d.WIKI[a].helpLink});s()};f.windowManager.open(j,{buttons:[{label:"confluence.conf_insert_button_title",action:function(){r({API:p.CONTEXT_PATH+d.WIKI[l()].restApi,successCallback:x,errorCallback:y,textToConvert:c.getElement("#insert-wiki-textarea").val(),
setBusy:true})}}],plugin_url:u,helpLink:d.DEFAULT.helpLink,hintText:"confluence.conf_wikimarkup_hint",cssClass:"insert-wiki-markup-panel"});if(n){var o=e("#wysiwygTextarea_ifr").contents().find("head").html(),A=g.Templates.InsertWiki.previewWikiIframeContent(),h=e("<iframe tabindex='-1' id='insert-wiki-markup-preview' />"),m;c.getElement("#insert-wiki-textarea-preview").append(h);h=h.contents();m=h[0];m.open();m.write(A);m.close();h.find("head").html(o);k=h.find("body");o=e(g.Templates.InsertWiki.wikiParserSelector(d));
c.getElement("#insert-wiki-insert-title").append(o);c.getElement("#wiki-parser-selection-tool").on("change",z);c.getElement("#insert-wiki-textarea").on("keydown",t.debounce(s,300))}});f.addButton("insertwikimarkup",{title:"confluence.conf_wikimarkup_desc",cmd:"InsertWikiMarkup"})},getInfo:function(){return{longname:"InsertWikiMarkip",author:"Atlassian",authorurl:"http://www.atlassian.com",infourl:"http://www.atlassian.com/",version:"1.1"}}}});
require("confluence/module-exporter").safeRequire("confluence-editor/tinymce3/plugins/insertwiki/editor_plugin_src",function(e){var b=require("tinymce");b.create("tinymce.plugins.InsertWikiMarkupPlugin",e);b.PluginManager.add("insertwikimarkup",b.plugins.InsertWikiMarkupPlugin)});