define("confluence-editor/tinymce3/plugins/autocomplete/autocomplete-manager",["ajs","jquery","window","confluence-editor/tinymce3/plugins/autocomplete/autocomplete-settings","confluence-editor/tinymce3/plugins/autocomplete/autocomplete-control"],function(f,k,p,n,o){n.log("Autocompleter.Manager");var c,a,j=function(g){var d=n.Settings[g.leadingChar],g=k.extend({minLengthForGetData:d.minLengthForGetData,displayHandler:d.displayHandler,Highlighter:d.Highlighter,classNames:d.autocompleteClassNames},
g);c=o(f.Rte.getEditor(),g);if(!c)return!1;f.trigger("synchrony.stop",{id:"confluence.autocomplete-plugin"});var q=k(p).width(),h,j=function(b){var i=k("#autocomplete-dropdown"),e=c.getContainer(),a,g,d,j,m;i.length||(i=k("<div></div>").addClass("aui-dd-parent quick-nav-drop-down").attr("id","autocomplete-dropdown").appendTo("body"));a=f.Position.spaceAboveBelow(f.Rte.getEditorFrame(),e);b.find("ol:has(a.menu-header)").addClass("top-menu-item");b.find("ol:empty").hide();i.append(b);d=f.Rte.Content.offset(e);
j=Math.max(i.width()+d.left-q+10,0);g=d.left-j-0;b=b.outerHeight(!0);m=b+10;if(h){var l;l=1==h?a.above>=m:a.below>=m;l||(h=null)}h||(h=a.below>=m?2:a.above>=m?1:a.below>a.above?2:1);a=i.find(".autocomplete-dropdown-arrow");a.length||(a=k("<div>").addClass("autocomplete-dropdown-arrow").addClass(c.settings.autocompleteClassNames));1===h?(a.addClass("autocomplete-dropdown-bottom-arrow").css({top:b-1}),e=d.top-b-10):(a.removeClass("autocomplete-dropdown-bottom-arrow").css("top",""),e=d.top+e.height()+
10);a.css({left:j}).appendTo(i);i.css({position:"absolute",top:e,left:g})};a=f.inputDrivenDropdown({onShow:function(b){f.trigger("rte-autocomplete-on-show",{triggerChar:c.settings.ch});var a=f.Rte.getEditorFrame();a&&a.shim&&a.shim.hide();b.find("a.menu-header").unbind().click(function(b){b.preventDefault();c.die()});this.reset();c.settings.selectFirstItem&&b.find("a:not('.menu-header')").length&&f.dropDown.current.moveDown()},dropdownPlacement:j,onDeath:function(){k("#autocomplete-dropdown").remove()},
ajsDropDownOptions:{selectionHandler:function(b,a){b.preventDefault();var e=k.data(a[0],"properties");e&&"function"===typeof e.callback?e.callback(c):"menu-header"!==e.className&&c.update(e);c.die()},moveHandler:function(b,a){var c=f.dropDown.current;b&&b.find("a").is(".menu-header")&&("up"==a?c.moveUp():c.moveDown())},className:"autocomplete "+c.settings.dropDownClassName,displayHandler:g.displayHandler,Highlighter:g.Highlighter},getDataAndRunCallback:function(b){c&&c.settings.getDataAndRunCallback&&
c.settings.getDataAndRunCallback(c,b,function(i,e,d,g){i.unshift([{className:"menu-header dropdown-prevent-highlight",href:"#",name:c.settings.getHeaderText(c,b)}]);i.push(c.settings.getAdditionalLinks(c,b,d));a&&a.show(i,e,g||[e])})},dropDownDelay:c.settings.dropDownDelay,minLengthForGetData:c.settings.minLengthForGetData});c.onBeforeKey=function(b,a){var c=require("tinymce");return 40===b.keyCode||38===b.keyCode||13===b.keyCode?(c.dom.Event.cancel(b),!1):27===b.keyCode||9===b.keyCode||8===b.keyCode&&
!a?(this.die(8===b.keyCode),!1):!0};c.onKeyPress=function(b){var a=require("tinymce"),e=String.fromCharCode(b.which||b.keyCode||0);if(13===b.keyCode)return a.dom.Event.cancel(b),!1;this.settings.endChars.includes(e)&&c.die();return!0};var l=RegExp("\\S{"+(g.minLengthForGetData||2)+",}");c.onAfterKey=function(b,d){if(40===b.keyCode||38===b.keyCode||13===b.keyCode){var e=f.dropDown.current;if(!e)return!1;if(-1==e.getFocusIndex()&&13===b.keyCode)return c.die(),c=null,!0;b.which||(b.which=b.keyCode);
return e.moveFocus(b)}if(!(e=8===b.keyCode&&!d))e=/[\u4E00-\u9FFF]/gi.test(d);(e||l.test(d))&&a.change(d,e);return!0};c.onDeath=function(){a&&(a.remove(),a.closing=!0);f.trigger("synchrony.start",{id:"confluence.autocomplete-plugin"})};c.onScroll=function(){a.dd&&j(a.dd.$)};c.getCurrentItem=function(){if(!a||!a.dd)return null;var b=a.dd,c=b.getFocusIndex();return 0>c?null:k.data(b.links[c],"properties")};a.change(c.text(),"force");return!0},l={getInputDrivenDropdown:function(){return a},triggerListener:function(c,
d){var f=require("tinymce");if(d.metaKey)return!0;var h=d.which||d.keyCode||0;a&&a.closing&&(a=null);h=String.fromCharCode(h);!a&&h in n.Settings&&j({leadingChar:h})&&f.dom.Event.cancel(d);return!0},shortcutFired:function(g,d){var f=d?0:1;a&&a.closing&&(a=null);a&&(f=d?0:c.backWords+1,c.die(),c=null);return j({leadingChar:g,backWords:f})},reattach:function(){var a=o.removeOrphanedControl();a&&l.shortcutFired(a.leadingChar)}};return l});
require("confluence/module-exporter").exportModuleAsGlobal("confluence-editor/tinymce3/plugins/autocomplete/autocomplete-manager","Confluence.Editor.Autocompleter.Manager");