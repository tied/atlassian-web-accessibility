define("confluence-ui-components/js/cql/internal/cql-type-picker",["jquery","underscore","ajs","confluence-ui-components/js/cql/internal/cql-ajax","confluence-ui-components/js/cql/internal/cql-set-value-helper","confluence-ui-components/js/cql/internal/cql-soy-templates","confluence-ui-components/js/include-exclude-picker"],function(f,k,h,a,g,b,d){var c;var e=[];function m(n){e=k.map(n,function(o){return{id:o.type,text:o.label}})}function l(){c=null;e=[]}function i(o,n){if(o.length===0){return""}if(o.length===1&&k.contains(k.pluck(n,"type"),o[0])){return o[0]}return"custom"}function j(o,s){var u;var n;var q;var t=[];if(!c){c=s?a.getContentTypes():a.getTypes();c.done(m)}c.done(function(){if(o.length){var v=k.pluck(e,"id");t=[].concat(e);o.forEach(function(w){if(w.type!==""&&!k.contains(v,w.type)){t.push({id:w.type,text:w.label})}})}else{t=e}});var r={query:function(v,x,w){c.done(function(){x(v.term);var y=window.Select2.query.local({results:k.map(t,w)});y(v)})},initSelection:function(w,z){var v=w.val().split(",");var y="";var x=k.map(v,function(A){var B=A.charAt(0);if(B==="-"){y="-";return A.substring(1)}return A});c.done(function(){var A=k.filter(t,function(B){return k.contains(x,B.id)});z(k.map(A,function(B){return{id:y+B.id,text:y+B.text}}))})},multiple:true,placeholder:h.I18n.getText("confluence-ui-components.type-picker.placeholder")};function p(v){u=v;if(h.trace){u.on("change",function(){h.trace("type.field.changed")})}if(o.length){var w=f(b.TypePicker().suggestions({types:o}));n=w.find(".aui-nav li");u.before(w);w.on("click",".aui-nav a",function(){var A=f(this).closest("li");var z=n.filter(".aui-nav-selected");if(A[0]===z[0]){return}z.removeClass("aui-nav-selected");A.addClass("aui-nav-selected");var y=f(this).attr("data-value");if(y==="custom"){q.slideDown("fast")}else{q.hide()}var x=true;u.select2("val",[y],x)})}u.auiSelect2(d.build(r));if(o.length){q=u.closest(".cql-filter").find(".select2-container");q.hide()}}return{setupInput:p,setValues:function(v){if(n){var w=i(v,o);var y=n.find('[data-value="'+w+'"]').parent();n.not(y).removeClass("aui-nav-selected");y.addClass("aui-nav-selected");if(w==="custom"){q.show()}}var x=f.Deferred();c.done(function(){g.setValues(u,v).done(function(){x.resolve()})});return x}}}return{build:j,_clearCache:l,_getPicklistKey:i}});