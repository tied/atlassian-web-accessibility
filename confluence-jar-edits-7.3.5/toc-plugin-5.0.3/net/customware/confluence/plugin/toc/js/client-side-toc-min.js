require(["ajs"],function(e){e.toInit(function(e){function t(t){return e(t).data("precedenceLevel")}function n(e,n){return n===t(e)}function i(r,o,c){if(0===r.length)return e();var a,s,u=r.map(t).reduce(function(e,t){return Math.min(e,t)});n(r[0],u)||r.unshift((a=u,(s=e({})).data("precedenceLevel",a),s));var l=o.createTocLevelContainer(),d={subElements:[],currentItem:void 0,outline:void 0,flush:function(){this.subElements.length>0&&this.currentItem&&(i(this.subElements,o,this.outline).appendTo(this.currentItem),this.subElements=[])},add:function(e){this.subElements.push(e)},resetItem:function(e){return this.outline=(c||[]).slice(0),this.outline.push(e),this.currentItem=o.createTocItemContainer(),this.currentItem.appendTo(l),this.currentItem}},f=0;return r.forEach(function(t){var i,r,o;n(t,u)?(f++,d.flush(),d.resetItem(f),t.textContent?(i=t,r=d.outline.join("."),o=i.id.replace(/[!"#$%&'()*+,.\/:;<=>?@[\\\]^`{|}~]/g,"\\\\$&"),e(Confluence.Plugins.TableOfContents.Client.tocItemBody({outline:r,linkHref:"#"+i.id,focusLink:'$("#'+o+'").focus();',linkText:i.textContent}))).appendTo(d.currentItem):d.currentItem.addClass("toc-empty-item")):d.add(t)}),d.flush(),0===c.length&&o.decorateToc&&o.decorateToc(l),l}function r(t,n){var r,o,c,a=n.headerelements,s=a.split(","),u=((r=n).includeheaderregex&&(o=new RegExp(r.includeheaderregex)),r.excludeheaderregex&&(c=new RegExp(r.excludeheaderregex)),function(){var t=e(this).text();return!(o&&!o.test(t)||c&&c.test(t))});return i(e("#main-content").find(a).filter(u).each(function(){var t,n;e(this).attr("tabindex","-1"),t=this,n=s.indexOf(this.nodeName),e(t).data("precedenceLevel",n)}).toArray(),t,[])}e(".client-side-toc-macro").each(function(){var t,n,i,o=e(this),c=o.data()||{};"flat"===c.structure?(i=c,t={createTocLevelContainer:function(){return this.createTocItemContainer()},createTocItemContainer:function(){return e(Confluence.Plugins.TableOfContents.Client.flatStyleTocItemContainer({cssClass:"toc-item-container"}))},decorateToc:function(t){function n(n,r){var o=n in i?i[n]:r;o&&e(Confluence.Plugins.TableOfContents.Client.flatStyleTocSeparator({separator:o})).appendTo(t)}n("preseparator","[ "),e(t).find("span.toc-item-body").each(function(i,r){i>0&&n("midseparator"," ] [ "),e(r).appendTo(t)}),n("postseparator"," ]"),e(t).find(".toc-item-container").remove()}}):(n=c,t={createTocLevelContainer:function(){return e(Confluence.Plugins.TableOfContents.Client.listStyleTocLevelContainer({cssliststyle:n.cssliststyle,csslistindent:n.csslistindent}))},createTocItemContainer:function(){return e(Confluence.Plugins.TableOfContents.Client.listStyleTocItemContainer())}}),!0!==c.numberedoutline&&o.addClass("hidden-outline"),o.html(r(t,c))})})});