define("confluence-space-directory/space-directory",["jquery","window","confluence/meta","confluence/legacy","ajs"],function(e,a,t,s,c){"use strict";return function(){var r=e("#space-directory .aui-nav li"),i=e("#space-search-query"),l="",n=function(){var a=e("#space-directory .aui-nav-selected");return{type:a.parent().attr("id"),tabName:a.find("a").data("tab-name")}},o=function(a){a&&a.type&&a.tabName?e("#"+a.type+" a[data-tab-name="+a.tabName+"]").parent().addClass("aui-nav-selected"):e("#space-system-list a[data-tab-name=site]").parent().addClass("aui-nav-selected")};e("#space-search-result").paginate({nameSpace:"space-directory",url:t.get("context-path")+"/rest/spacedirectory/1/search",cache:!1,pageUrl:t.get("context-path")+"/spacedirectory/view.action",getParams:function(){var a,s=t.get("remote-user"),r="current",i=[];s&&e("#favourites-toggle").hasClass("aui-nav-selected")&&(i=["~"+s+":favourite","~"+s+":favorite"],e("#space-search-title-bar .space-search-title").text(c.I18n.getText("favourite.spaces")));var n=e(".team-label.aui-nav-selected a");if(n.length>0&&(i.push("team:"+n.attr("data-tab-name")),r=n.attr("data-status-name"),e("#space-search-title-bar .space-search-title").text(n.text())),!i.length){var o=e(".space-type.aui-nav-selected a");o.length>0&&(a=o.attr("data-type-name"),r=o.attr("data-status-name"),e("#space-search-title-bar .space-search-title").text(o.text())),a||e("#space-search-title-bar .space-search-title").text(c.I18n.getText("spaces.all"))}return{query:l,label:i,type:a,status:r}},pageSize:+c.params.pageSize,startIndex:0,preprocess:function(){e(".no-results").addClass("hidden"),e("#aui-message-bar").empty()},insertResults:function(a,c){var r,l=a.spaces,o=0===l.length;e(".no-results").toggleClass("hidden",!o||"space-system-list"===(r=n()).type&&"all"===r.tabName&&!i.val()),e(".space-list-section").toggleClass("hidden",o),e("#space-directory-help").toggleClass("hidden",o),0==e("#space-list caption").length&&e("#space-list").prepend("<caption class='assistive' aria-label='Space List'>Space List</caption>");for(var p=0,u=l.length;p<u;p++){var d=l[p],f=s.Templates.SpaceDirectory.spaceListItem({spaceKey:d.key,spaceName:d.name,truncatedSpaceName:d.name,spaceDescHtml:d.description,spaceUrl:d.link[1].href,logoUrl:d.logo.href,remoteUser:t.get("remote-user"),accessMode:t.get("access-mode")}),m=e(f);c.append(m);var g=d.favourite;e(".space-favourites a.aui-iconfont-star-filled",m).toggleClass("hidden",!g),e(".space-favourites a.aui-iconfont-new-star",m).toggleClass("hidden",g);var h=d.labels.label;if(h.length>0){for(var v=e(".space-labels",m),y=0,b=0,C=h.length;b<C;b++)if("team"===h[b].namespace){var S=e(s.Templates.SpaceDirectory.spaceLabel({spaceLabel:h[b].name}));y>2?S.addClass("hidden"):y++,v.append(S)}y>2&&v.append(s.Templates.SpaceDirectory.spaceLabelEllipsis())}}e(".space-favourites").favourites({})},handleError:function(){c.messages.error({body:c.I18n.getText("search.spaces.error"),closeable:!1})}});var p=function(){e("#space-search-result").hasClass("updating-container")||c.trigger("update-list.space-directory",{startIndex:0}),a.localStorage.setItem("lastSelectedSpaceDirectoryTab",JSON.stringify(n()))},u=function(e,a){c.trigger("analytics",{name:"confluence.space-directory."+e,data:a||{}})};r.click(function(a){var t=e(this);a.preventDefault(),r.removeClass("aui-nav-selected"),t.addClass("aui-nav-selected"),e("#space-search-result").focus(),p();var s=e.trim(t.text()).toLowerCase().replace(/\s/g,"-"),c=t.hasClass("team-label");u((c?"category":s+"-filter")+".click",{category:n().tabName})});var d,f=e("#space-list");f.on("click",".space-name a",function(e){u("space.click")}),f.on("click",".space-label",function(a){a.preventDefault(),r.removeClass("aui-nav-selected"),e(".team-label a[data-tab-name='"+e(this).text()+"']").parent().addClass("aui-nav-selected"),p(),e("#space-search-result").focus(),u("space.category.click")}),f.on("click",".entity-info-icon a",function(){u("space.info.click")}),i.keyup(function(){var a=e.trim(i.val());i.hasClass("placeholded")&&(a=""),/^\S{1,2}$/.test(a)||(""!==a&&(a=a+" OR "+a+"*"),l!==a&&(l=a,clearTimeout(d),d=setTimeout(function(){p(),u("filter")},200)))}),e("#space-search-form").submit(function(t){var s=e("#space-list .space-list-item");if(!e("#space-search-result").hasClass("updating-container")&&1===s.length)return a.location=e(s[0]).find(".space-name a").attr("href"),t.stopPropagation(),!1});var m=e("#space-directory").data("selected-tab");o(m?{type:"space-labels-list",tabName:m}:JSON.parse(localStorage.getItem("lastSelectedSpaceDirectoryTab"))),p()}}),require("confluence/module-exporter").safeRequire("confluence-space-directory/space-directory",function(e){"use strict";require("ajs").toInit(e)});