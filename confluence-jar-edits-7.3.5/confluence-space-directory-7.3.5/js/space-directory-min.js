define("confluence-space-directory/space-directory",["jquery","window","confluence/meta","confluence/legacy","ajs"],function(b,s,m,o,g){return function(){var p=b("#space-directory .aui-nav li"),n=b("#space-search-query"),q="",r=function(){var a=b("#space-directory .aui-nav-selected");return{type:a.parent().attr("id"),tabName:a.find("a").data("tab-name")}},v=function(){var a=r();return"space-system-list"===a.type&&"all"===a.tabName},t=function(a){a&&a.type&&a.tabName?b("#"+a.type+" a[data-tab-name="+
a.tabName+"]").parent().addClass("aui-nav-selected"):b("#space-system-list a[data-tab-name=site]").parent().addClass("aui-nav-selected")};b("#space-search-result").paginate({nameSpace:"space-directory",url:m.get("context-path")+"/rest/spacedirectory/1/search",cache:!1,pageUrl:m.get("context-path")+"/spacedirectory/view.action",getParams:function(){var a=m.get("remote-user"),c="current",i=[],e;a&&b("#favourites-toggle").hasClass("aui-nav-selected")&&(i=["~"+a+":favourite","~"+a+":favorite"],b("#space-search-title-bar .space-search-title").text(g.I18n.getText("favourite.spaces")));
a=b(".team-label.aui-nav-selected a");0<a.length&&(i.push("team:"+a.attr("data-tab-name")),c=a.attr("data-status-name"),b("#space-search-title-bar .space-search-title").text(a.text()));i.length||(a=b(".space-type.aui-nav-selected a"),0<a.length&&(e=a.attr("data-type-name"),c=a.attr("data-status-name"),b("#space-search-title-bar .space-search-title").text(a.text())),e||b("#space-search-title-bar .space-search-title").text(g.I18n.getText("spaces.all")));return{query:q,label:i,type:e,status:c}},pageSize:+g.params.pageSize,
startIndex:0,preprocess:function(){b(".no-results").addClass("hidden");b("#aui-message-bar").empty()},insertResults:function(a,c){var i=a.spaces,e=0===i.length;b(".no-results").toggleClass("hidden",!e||v()&&!n.val());b(".space-list-section").toggleClass("hidden",e);b("#space-directory-help").toggleClass("hidden",e);for(var e=0,g=i.length;e<g;e++){var d=i[e],h=o.Templates.SpaceDirectory.spaceListItem({spaceKey:d.key,spaceName:d.name,truncatedSpaceName:d.name,spaceDescHtml:d.description,spaceUrl:d.link[1].href,
logoUrl:d.logo.href,remoteUser:m.get("remote-user"),accessMode:m.get("access-mode")}),h=b(h);c.append(h);var l=d.favourite;b(".space-favourites a.aui-iconfont-star-filled",h).toggleClass("hidden",!l);b(".space-favourites a.aui-iconfont-new-star",h).toggleClass("hidden",l);d=d.labels.label;if(0<d.length){for(var h=b(".space-labels",h),f=l=0,k=d.length;f<k;f++)if("team"===d[f].namespace){var j=b(o.Templates.SpaceDirectory.spaceLabel({spaceLabel:d[f].name}));2<l?j.addClass("hidden"):l++;h.append(j)}2<
l&&h.append(o.Templates.SpaceDirectory.spaceLabelEllipsis())}}b(".space-favourites").favourites({})},handleError:function(){g.messages.error({body:g.I18n.getText("search.spaces.error"),closeable:!1})}});var j=function(){b("#space-search-result").hasClass("updating-container")||g.trigger("update-list.space-directory",{startIndex:0});s.localStorage.setItem("lastSelectedSpaceDirectoryTab",JSON.stringify(r()))},f=function(a,b){g.trigger("analytics",{name:"confluence.space-directory."+a,data:b||{}})};
p.click(function(a){var c=b(this);a.preventDefault();p.removeClass("aui-nav-selected");c.addClass("aui-nav-selected");j();a=b.trim(c.text()).toLowerCase().replace(/\s/g,"-");c=c.hasClass("team-label")?"category":a+"-filter";f(c+".click",{category:r().tabName})});var k=b("#space-list");k.on("click",".space-name a",function(){f("space.click")});k.on("click",".space-label",function(a){a.preventDefault();p.removeClass("aui-nav-selected");b(".team-label a[data-tab-name='"+b(this).text()+"']").parent().addClass("aui-nav-selected");
j();f("space.category.click")});k.on("click",".entity-info-icon a",function(){f("space.info.click")});var u;n.keyup(function(){var a=b.trim(n.val());n.hasClass("placeholded")&&(a="");/^\S{1,2}$/.test(a)||(""!==a&&(a=a+" OR "+a+"*"),q!==a&&(q=a,clearTimeout(u),u=setTimeout(function(){j();f("filter")},200)))});b("#space-search-form").submit(function(a){var c=b("#space-list .space-list-item");if(!b("#space-search-result").hasClass("updating-container")&&1===c.length)return s.location=b(c[0]).find(".space-name a").attr("href"),
a.stopPropagation(),!1});(k=b("#space-directory").data("selected-tab"))?t({type:"space-labels-list",tabName:k}):t(JSON.parse(localStorage.getItem("lastSelectedSpaceDirectoryTab")));j()}});require("confluence/module-exporter").safeRequire("confluence-space-directory/space-directory",function(b){require("ajs").toInit(b)});