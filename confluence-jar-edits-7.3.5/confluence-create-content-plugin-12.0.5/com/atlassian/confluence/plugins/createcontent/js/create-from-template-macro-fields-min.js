AJS.toInit(function(f){function b(j,k){j=j||AJS.Meta.get("space-key");var h=function(l){var m=Confluence.Blueprint.Dialog.loadedWebitems[j];if(_.isEmpty(m)){AJS.log("create-from-template-macro-fields: No Create dialog web items found for spaceKey >"+j+"<");return}k(l,m)};var i=function(){AJS.error("create-from-template-macro-fields: requestWebItems call for spaceKey >"+j+"< failed")};Confluence.Blueprint.Dialog.requestWebItems(j,false,h,i)}function c(h,i){b(i,function(k,l){var j=h.val();h.empty();_.each(l,function(m){var o=m.itemModuleCompleteKey;if((o==="com.atlassian.confluence.plugins.confluence-create-content-plugin:create-blank-page"||o==="com.atlassian.confluence.plugins.confluence-create-content-plugin:create-blog-post")){return}if(!(m.templateId||m.contentBlueprintId)){return}var n=f("<option></option>").text(m.name);n.attr("data-template-id",m.templateId);n.attr("data-blueprint-module-complete-key",m.blueprintModuleCompleteKey);n.attr("data-content-blueprint-id",m.contentBlueprintId);n.attr("data-create-result",m.createResult);n.val(m.templateId||m.contentBlueprintId);h.append(n)});h.val(j)})}var g={fields:{spacekey:{spaceKey:function e(k){var j=AJS.MacroBrowser.ParameterFields.spacekey(k),h=j.input.val();var i=function(){var l=j.input.val();if(l!=h){c(AJS.MacroBrowser.fields.templateName.input,l)}h=l};j.input.bind("selected.autocomplete-content",i);j.input.blur(i);return j}}},beforeParamsSet:function a(i,h){i.buttonLabel=i.buttonLabel||i.createButtonLabel||AJS.I18n.getText("com.atlassian.confluence.plugins.confluence-create-content-plugin.create-from-template.param.buttonLabel.default-value");c(f("#macro-param-templateName"),i.spaceKey);return i},beforeParamsRetrieved:function d(j,k,h){var i=AJS.MacroBrowser.fields.templateName.input.find("option:selected");j.blueprintModuleCompleteKey=i.data("blueprint-module-complete-key");j.contentBlueprintId=i.data("content-blueprint-id");j.templateId=i.data("template-id");j.createResult=i.data("create-result");return j}};AJS.MacroBrowser.setMacroJsOverride("create-from-template",g)});