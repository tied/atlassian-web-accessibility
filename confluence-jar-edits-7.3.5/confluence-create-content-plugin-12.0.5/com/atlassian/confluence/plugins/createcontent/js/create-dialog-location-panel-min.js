(function(a){Confluence.Dialogs=Confluence.Dialogs||{};Confluence.Dialogs.LocationPanel=function b(g){AJS.bind(Confluence.Dialogs.Events.ITEM_SELECTED,e);var k,s,i,l,o=g.openDialog;var p;var r=null;var m="com.atlassian.confluence.plugins.confluence-create-content-plugin:create-blog-post";function c(u,t){var v=i.find(".template-select-container");v.addClass("loading");a("#create-dialog").find(".wait-icon").spin("medium");t.requestWebItems(u).done(function(w){t.fillWebItemsInDialog(false);a("#create-dialog").find(".wait-icon").spinStop()}).fail(function(){Confluence.sessionFail&&Confluence.sessionFail()})}g.openDialog=function(v){var u;if(!v||!v.createDialog){u=o(v)}else{u=v.createDialog}if(v&&v.dialogBase){AJS.$.extend(u,v.dialogBase)}i=u.popup.element;if(v.errorMessage){u.setDialogError(v.errorMessage)}else{var w=i.find(".create-dialog-body").prepend(Confluence.Templates.Blueprints.createDialogLocationPanel({}));l=w.find("#create-dialog-parent-container");p=w.find(".space-select");var t=g.loadedSpaces;defaultSpace=t.promotedSpaces.spaces[0]||t.otherSpaces.spaces[0];q(t,i);if(!i.options.showStepOne){g.fillWebItemsInDialog(false)}if(!s){s=j(defaultSpace.id)}s.done(function(x){n(x,i)});i.find(".create-dialog-location-bar input.space-select").change(function(){var x=a(this).val();c(x,u);j(x).done(function(y){n(y,i)})});i.options.updateHeight&&u.updateHeight()}return u};g.getParentPageId=function(){return r};g.filterWebItems=function(t){if(i.options.location=="child-page"){return _.reject(t,function(u){return u.itemModuleCompleteKey==m})}return t};g.getSpaceKey=function f(){var t=p.val();return t||AJS.Meta.get("space-key")};function e(v,w){if(!l||!l.length){AJS.log("WARNING: refreshLocation should not be getting triggered - $locationDiv is not set");return}var u;if(w){if(w.config){u=w.config}else{if(w.item){u=w.item.data()}}}var y=u&&(u.itemModuleCompleteKey||u.templateId)||null;var t=a("#page-restricted-container").length||a(".request-access-container").length;if(!w.noVisibleItem&&!t&&h(y,u.spaceKey)){var x=Confluence.Blueprint.Util.getParentPageLocation();l.find("span").text(x.parentPageTitle);l.show();r=x.parentPageId}else{l.hide();r=null}}function h(w,v){if(!w){return true}var u=AJS.Meta.get("space-key"),t=v||p.val();if(!u||(u!=t)){return false}if(!Confluence.Blueprint.Util.getParentPageLocation().parentPageTitle){return false}if(AJS.Meta.get("content-type")!="page"){return false}if(w=="com.atlassian.confluence.plugins.confluence-business-blueprints:sharelinks-blueprint-item"){return false}return(w!=m)}function d(v){var u=[];var w=v.promotedSpaces.spaces;if(w&&w.length){u.push({text:AJS.I18n.getText("create.content.plugin.promoted.spaces"),children:w})}var t=v.otherSpaces&&!v.otherSpaces.resultsTruncated&&v.otherSpaces.spaces;if(t&&t.length){u.push({text:AJS.I18n.getText("spaces.all"),children:t})}return u}function q(A,z){if(A.otherSpaces&&A.otherSpaces.resultsTruncated){var v=z.find(".space-select-control-container .description");v.removeClass("hidden");var w={gravity:"w",delayIn:500,delayOut:0,offset:5};v.find("a").tooltip(w).click(function(){return false})}p.auiSelect2({data:d(A),escapeMarkup:function(B){return B},width:"270px",containerCssClass:"select2-space-select",formatResult:function(B,C,D){C.attr("title",a("<div/>").html(B.text).text());return a.fn.select2.defaults.formatResult.apply(this,arguments)},openOnEnter:false});var u=p.data("select2");u.data(A.promotedSpaces.spaces[0]||A.otherSpaces.spaces[0]);var x=50;var t=u.opts.populateResults;u.opts.populateResults=function(B,C,D){var F=false;var E=C;if(C[1]&&C[1].children&&C[1].children.length>x){E=[];a(C).each2(function(){E.push(a.extend(true,{},this))});E[1].children=E[1].children.slice(0,x);E[1].children.push({text:AJS.I18n.getText("create.content.plugin.select.space.see.more")});F=true}t.call(u,B,E,D);F&&C[1].children.pop()};var y=z.find(".select2-space-select .select2-input");if(y.length&&"placeholder" in y[0]){y.attr("placeholder",AJS.I18n.getText("create.content.plugin.create-dialog.space.dropdown.filter.placeholder-text")+" ...")}}function j(t){return a.ajax({url:Confluence.getContextPath()+"/rest/create-dialog/1.0/spaces/adminCheck",dataType:"json",data:{spaceKey:t}})}function n(x,w){var t=x,z=w.find(".add-remove-customise-templates-trigger");var y=Confluence.getContextPath(),v;if(t){y+="/pages/templates2/listpagetemplates.action?key="+p.val();v=AJS.I18n.getText("create.content.plugin.plugin.add.or.customize.templates")}else{y+="/plugins/servlet/upm/marketplace/featured?category=Blueprints";v=AJS.I18n.getText("create.content.plugin.plugin.find.more.content")}var u=Confluence.Templates.Blueprints.customiseTemplatesLink({linkUrl:y,linkText:v});if(z.length){z.replaceWith(u)}else{w.find(".dialog-button-panel:first").prepend(u)}}}}(AJS.$));