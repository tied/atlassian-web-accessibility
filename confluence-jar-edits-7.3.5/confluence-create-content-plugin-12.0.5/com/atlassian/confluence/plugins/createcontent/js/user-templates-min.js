AJS.toInit(function(e){var c=require("confluence/form-state-control");var d=AJS.Meta.get("space-key");if(!d){d=e("meta[name=confluence-space-key]").attr("content")}var b="/rest/create-dialog/1.0/promotion/promote-template/";e.ajax({url:Confluence.getContextPath()+b,data:{spaceKey:d},type:"GET",contentType:"application/json"}).done(function(f){e("#pagetemplates-table").find("tr[data-pagetemplate-id]").each(function(){var k=e(this),i=k.data("pagetemplate-id"),h=k.find(".template-operations"),j=Confluence.Templates.Blueprints.Promoted.middot(),g=Confluence.Templates.Blueprints.Promoted.promoteTemplateLink({templatePromoted:_.contains(f,i)});if(!h.is(":empty")){h.prepend(j)}h.prepend(g);k.find(".promoted-template-link").tooltip({aria:true})})});e("#pagetemplates-table").on("click",".promoted-template-link",function(){var g=e(this),h=g.attr("data-promoted")==="true",f=g.parents("tr[data-pagetemplate-id]").data("pagetemplate-id");a(g,h,f);event.preventDefault()});var a=function(h,g,f){c.disableElement(h);AJS.trigger("analytics",{name:"blueprint.user.template."+(g?"unpromote":"promote"),data:{}});e.ajax({url:Confluence.getContextPath()+b+f+"?"+jQuery.param({spaceKey:d}),type:g?"DELETE":"PUT",contentType:"application/json"}).done(function(){h.attr("data-promoted",!g);h.text(g?AJS.I18n.getText("create.content.plugin.templates.promoted.name"):AJS.I18n.getText("create.content.plugin.templates.non.promoted.name"))}).fail(function(){AJS.log("Could not promote/demote template with id: "+f)}).always(function(){c.enableElement(h)})}});