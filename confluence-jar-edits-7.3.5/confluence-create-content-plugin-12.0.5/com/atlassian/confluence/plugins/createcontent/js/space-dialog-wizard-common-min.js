AJS.toInit(function(f){var k,i,b,h,e,j,m=100,n={name:f.Deferred().reject(),spaceKey:f.Deferred().reject()};var g={spaceKey:function(){var o=f.Deferred();var p=f.trim(k.val());if(!p){o.reject(AJS.I18n.getText("space.key.empty"));n.spaceKey=o;return o.promise()}if(j){AJS.log("Aborting previous space key validation request.");j.abort()}j=f.getJSON(AJS.Confluence.getContextPath()+"/ajax/spaceavailable.action",{key:p}).done(function(q){if(!q.available&&q.message){o.reject(q.message)}else{o.resolve()}j=false});n.spaceKey=o;return o.promise()},name:function(){var o=f.Deferred();if(!f.trim(i.val())){o.reject(AJS.I18n.getText("space.name.empty"))}else{o.resolve()}n.name=o;return o.promise()}};function d(r){var q=r[0];if(q.setSelectionRange){var p=r.val().length;q.setSelectionRange(0,p)}else{if(q.createTextRange){var o=q.createTextRange();o.execCommand("SelectAll");o.select()}}}function a(o){if(o){b.removeAttr("disabled")}else{b.attr("disabled","disabled")}}function c(q){var o=q.attr("name");var p=q.siblings(".error");var r=g[o]();r.done(function(){p.text("").addClass("hidden")});r.fail(function(t,s){if(!s){p.text(t).removeClass("hidden")}});r.always(function(){q.attr("data-validated-value",q.val())});return r}function l(o){a(false);k=o.find("input[name='spaceKey']").first();i=o.find("input[name='name']").first();h=k.parent().find(".error");e=i.parent().find(".error");k.generateFrom(i,{uppercase:false,maxNameLength:255,maxKeyLength:255,timeoutMS:m,validationCallback:function(){k.trigger("input")}});function s(t){if(t.state()==="pending"){t.reject("",true)}}function q(){c(f(this));f.when.apply(f,_.values(n)).done(function(){a(true)}).fail(function(u,t){if(!t){a(false)}})}var r=f.debounce(q,250);var p=f.debounce(q,250);i.on("change input",function(){r.apply(this,arguments)});k.on("change input",function(){_.each(n,s);j&&j.abort();p.apply(this,arguments)});k.focus(function(){d(k)});o.find("#permission-private").change(function(){f("#permissions-group").toggleClass("aui-iconfont-unlocked");f("#permissions-group").toggleClass("aui-iconfont-locked")})}f(document).tooltip({live:".common-space-form .aui-iconfont-help",gravity:"w",title:"data-tooltip",delayIn:250,delayOut:0});Confluence.SpaceBlueprint.CommonWizardBindings={preRender:function(p,o){o.soyRenderContext.atlToken=AJS.Meta.get("atl-token");o.soyRenderContext.showSpacePermission=true},postRender:function(p,o){b=f(".create-dialog-create-button:visible");l(o.$container)},submit:function(r,q){setTimeout(function(){var t=c(k);var s=c(i);f.when(t,s).done(q.validationDeferred.resolve).fail(function(){q.validationDeferred.reject.apply(this,arguments);a(false)})},m+1);var p=f("form.common-space-form");var o="unknown";if(p.length){o=p.attr("id")||"blank-space"}AJS.Analytics?AJS.Analytics.triggerPrivacyPolicySafeEvent("confluence-spaces.blueprint-created",{blueprint:o}):AJS.trigger("analyticsEvent",{name:"confluence-spaces.blueprint-created",data:{blueprint:o}});q.async=true;return false}}});