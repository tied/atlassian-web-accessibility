define("confluence-space-ia/sidebar-space-tools",["ajs","jquery","confluence/legacy"],function(e,a,i){return function(){var t,o,s,l,n,d=[],r=[],c=0===e.version.indexOf("5.7");c||(s=a("#space-tools-menu-trigger"),l=a("#space-tools-menu")),c?a("#space-tools-web-items").children("div").each(function(){d.push({label:a(this).data("label"),href:a(this).data("href")})}):(e.warn("Remove legacy sidebar code when upgrade to AUI 5.8+"),l.on({"aui-dropdown2-show":function(){e.trigger("sidebar.disable-tooltip",s)},"aui-dropdown2-hide":function(){e.trigger("sidebar.enable-all-tooltips")}}),a("#space-tools-web-items").children("div").each(function(){d.push({text:a(this).data("label"),href:a(this).data("href")})})),c?a("#space-tools-menu-additional-items").children("div").each(function(){r.push({className:a(this).data("class"),label:a(this).data("label"),href:a(this).data("href")})}):a("#space-tools-menu-additional-items").children("div").each(function(){r.push({extraClasses:a(this).data("class"),text:a(this).data("label"),href:a(this).data("href")})}),c?(o={hideDelay:null,width:170,displayShadow:!1,calculatePositions:function(e,a){var i=a.target.offset();return{popupCss:{top:i.top-e.height(),left:i.left},arrowCss:{display:"none"}}},hideCallback:function(){e.trigger("sidebar.enable-all-tooltips")}},(t=e.InlineDialog(a("#space-tools-menu-trigger"),"space-tools",function(o,s,l){return o.html(i.Templates.Sidebar.spaceToolsMenu({spaceToolLinks:d,spaceLinks:r,isAuiFiveSeven:c})),a(s).one("click",function(e){a("#inline-dialog-space-tools").is(":visible")&&setTimeout(function(){t.hide()},0)}),e.trigger("sidebar.disable-tooltip",s),e.trigger("sidebar.spacetools-loaded"),l(),!1},o)).addClass("aui-dropdown2 aui-style-default space-tools-dropdown"),e.bind("sidebar.hide-overlays",t.hide)):(l.html(i.Templates.Sidebar.spaceToolsMenu({spaceToolLinks:d,spaceLinks:r})),e&&e.Confluence&&e.Confluence.Analytics&&e.Confluence.Analytics.setAnalyticsSource&&e.Confluence.Analytics.setAnalyticsSource(l.find("a:not(.configure-sidebar)"),"spacetools"),e.bind("sidebar.hide-overlays",function(){l.filter('[aria-hidden="false"]').length&&a("#space-tools-menu-trigger").trigger("aui-button-invoke")})),(n=a(".expand-collapse-trigger")).click(function(e){e.preventDefault(),i.Sidebar.toggle()}),n.attr("data-tooltip",a(".ia-fixed-sidebar").hasClass("collapsed")?i.Sidebar.expandTooltip:i.Sidebar.collapseTooltip),e.bind("sidebar.collapsed",function(){n.attr("data-tooltip",i.Sidebar.expandTooltip),n.attr("aria-expanded","false")}),e.bind("sidebar.expanded",function(){n.attr("data-tooltip",i.Sidebar.collapseTooltip),n.attr("aria-expanded","true")})}});