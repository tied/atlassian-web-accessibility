define("confluence-space-ia/avatar-picker/client-file-handler",["jquery","underscore"],function(c,b){function a(d){return this.init(d)}a.typeFilters={all:/.*/,application:/^application\/.*/,audio:/^audio\/.*/,image:/^image\/.*/,imageWeb:/^image\/(jpeg|png|gif)$/,text:/^text\/.*/,video:/^video\/.*/};a.prototype.defaults={fileTypeFilter:a.typeFilters.all,fileCountLimit:Infinity,fileSizeLimit:20*1024*1024,onSuccess:c.noop,onError:c.noop};a.prototype.init=function(d){this.options=c.extend({},this.defaults,d);if(d&&!d.fileSizeLimit){this.options.fileSizeLimit=this.defaults.fileSizeLimit}if(d&&!d.fileCountLimit){this.options.fileCountLimit=this.defaults.fileCountLimit}b.bindAll(this,"handleFiles","filterFiles");return this};a.prototype.handleFiles=function(f,e){var d=this.filterFiles(f);if(d.valid.length>0){b.isFunction(this.options.onSuccess)&&this.options.onSuccess(d.valid)}else{b.isFunction(this.options.onError)&&this.options.onError(d.invalid)}};a.prototype.filterFiles=function(e){var h=b.isRegExp(this.options.fileTypeFilter)?this.options.fileTypeFilter:this.defaults.fileTypeFilter,d=this.options.fileSizeLimit,g={byType:[],bySize:[],byCount:[]},f=b.filter(e,function(i){if(!h.test(i.type)){g.byType.push(i);return false}if(i.size>d){g.bySize.push(i);return false}return true});if(f.length>this.options.fileCountLimit){g.byCount=f.slice(this.options.fileCountLimit);f=f.slice(0,this.options.fileCountLimit)}return{valid:f,invalid:g}};return a});