define("office-connector/edit-in-office",["jquery","ajs","confluence/custom-protocol-launcher"],function(f,i,b){function a(m){var l=m.substring(m.lastIndexOf(".")+1);switch(l){case"ppt":case"pptx":case"ppsx":case"pot":case"potx":case"pptm":return"PowerPoint.Show";case"doc":case"docx":case"dot":case"dotx":return"Word.Document";case"xls":case"xlt":case"xlsx":case"xlst":case"xlsm":case"xltx":return"Excel.Sheet";default:return""}}function e(m,n,l){i.$.ajax({url:contextPath+"/rest/office/1.0/authtoken",success:function(r){if(r.token){var o=m.split("/");var q="";for(var p=0;p<o.length-1;p++){if(o[p].length){q=q+"/"+o[p]}}q=q+"/ocauth/"+r.token+"/"+o[o.length-1];n(q)}else{l("Unable to retrieve a temporary auth token. Check your server logs.")}},error:function(o,q,p){l("Ajax error retrieving token: "+q+", error from server: "+p)},statusCode:{403:function(){l("The current configuration requires you to be logged in to use the Office Connector.")}}})}function g(){return location.protocol+"//"+location.host}function d(l){alert(l)}function j(m,r,n,q){var p=g();if(typeof window.ActiveXObject!=="undefined"||"ActiveXObject" in window){var l;try{l=new ActiveXObject("SharePoint.OpenDocuments.1")}catch(o){window.alert("Unable to create an ActiveX object to open the document. This is most likely because of the security settings for your browser.");return false}if(l){e(r,function(s){l.EditDocument(p+s,n)},d);return false}else{window.alert("Cannot instantiate the required ActiveX control to open the document. This is most likely because you do not have Office installed or you have an older version of Office.");return false}}else{h(q,r)}return false}function h(l,m){e(m,k,d)}function c(l){var m=l.substring(l.lastIndexOf(".")+1).toLowerCase();switch(m){case"ppt":case"pptx":case"ppsx":case"pot":case"potx":case"pptm":return"ms-powerpoint";case"doc":case"docx":case"dot":case"dotx":return"ms-word";case"xls":case"xlt":case"xlsx":case"xlst":case"xlsm":case"xltx":return"ms-excel";default:return""}}function k(l){try{var m=c(l)+":ofe|u|"+g()+l;b.openUri(m)}catch(n){console.log(n);window.alert("Unable to open your Office file. Have you installed MS Office yet?")}}return{getProgID:a,doEditInOffice:j}});AJS.toInit(function(b){var c=require("office-connector/edit-in-office");var a=AJS.Data.get("context-path");var d=b("#edit-in-word, #edit-in-word-pathauth, a.office-editable, a.office-editable-pathauth");d.click(function(i){i.preventDefault();var h=b(this);var g=h.attr("data-use-path-auth");if(typeof(g)=="undefined"){g=(h.attr("id")=="edit-in-word-pathauth"||h.hasClass("office-editable-pathauth"))}else{g=(g==="true")}var j=h.attr("href");var f=h.attr("data-prog-id");if(typeof(f)=="undefined"){f=c.getProgID(j)}return c.doEditInOffice(a,j,f,g)})});