(function(s,j,f,p){function G(f,e,k,g){var b,a,d,q,m=this;var c=y[f.id],r=function(c){b=j.createElement("canvas");b.style.display="none";j.body.appendChild(b);a=b.getContext("2d");d=new Image;d.onerror=d.onabort=function(){g({success:!1})};d.onload=function(){var r,t,j,o;e.width||(e.width=d.width);e.height||(e.height=d.height);q=Math.min(e.width/d.width,e.height/d.height);if(1>q||1===q&&"image/jpeg"===k){r=Math.round(d.width*q);t=Math.round(d.height*q);b.width=r;b.height=t;a.drawImage(d,0,0,r,t);
if("image/jpeg"===k){if(j=new w(atob(c.substring(c.indexOf("base64,")+7))),j.headers&&j.headers.length&&(o=new H,o.init(j.get("exif")[0])&&(o.setExif("PixelXDimension",r),o.setExif("PixelYDimension",t),j.set("exif",o.getBinary()),m.hasEventListener("ExifData")&&m.trigger("ExifData",f,o.EXIF()),m.hasEventListener("GpsData")&&m.trigger("GpsData",f,o.GPS()))),e.quality)try{c=b.toDataURL(k,e.quality/100)}catch(s){c=b.toDataURL(k)}}else c=b.toDataURL(k);c=c.substring(c.indexOf("base64,")+7);c=atob(c);
j&&(j.headers&&j.headers.length)&&(c=j.restore(c),j.purge());b.parentNode.removeChild(b);g({success:!0,data:c})}else g({success:!1})};d.src=c},t;"FileReader"in s?(t=new FileReader,t.readAsDataURL(c),t.onload=function(){r(t.result)}):r(c.getAsDataURL())}function C(){function f(b,a){var d=k?0:-8*(a-1),q=0,m;for(m=0;m<a;m++)q|=g.charCodeAt(b+m)<<Math.abs(d+8*m);return q}function e(b,a,d){d=3===arguments.length?d:g.length-a-1;g=g.substr(0,a)+b+g.substr(d+a)}var k=!1,g;return{II:function(b){if(b===p)return k;
k=b},init:function(b){k=!1;g=b},SEGMENT:function(b,a,d){switch(arguments.length){case 1:return g.substr(b,g.length-b-1);case 2:return g.substr(b,a);case 3:e(d,b,a);break;default:return g}},BYTE:function(b){return f(b,1)},SHORT:function(b){return f(b,2)},LONG:function(b,a){if(a===p)return f(b,4);var d="",q=k?0:-24,m;for(m=0;4>m;m++)d+=String.fromCharCode(a>>Math.abs(q+8*m)&255);e(d,b,4)},SLONG:function(b){b=f(b,4);return 2147483647<b?b-4294967296:b},STRING:function(b,a){for(var d="",a=a+b;b<a;b++)d+=
String.fromCharCode(f(b,1));return d}}}function w(f){var e={65505:{app:"EXIF",name:"APP1",signature:"Exif\x00"},65506:{app:"ICC",name:"APP2",signature:"ICC_PROFILE\x00"},65517:{app:"IPTC",name:"APP13",signature:"Photoshop 3.0\x00"}},k=[],g,b,a=p,d=0;g=new C;g.init(f);if(65496===g.SHORT(0)){b=2;for(f=Math.min(1048576,f.length);b<=f;)if(a=g.SHORT(b),65488<=a&&65495>=a)b+=2;else{if(65498===a||65497===a)break;d=g.SHORT(b+2)+2;e[a]&&g.STRING(b+4,e[a].signature.length)===e[a].signature&&k.push({hex:a,app:e[a].app.toUpperCase(),
name:e[a].name.toUpperCase(),start:b,length:d,segment:g.SEGMENT(b,d)});b+=d}g.init(null);return{headers:k,restore:function(a){g.init(a);var d=new w(a);if(!d.headers)return!1;for(a=d.headers.length;0<a;a--){var c=d.headers[a-1];g.SEGMENT(c.start,c.length,"")}d.purge();b=65504==g.SHORT(2)?4+g.SHORT(4):2;a=0;for(d=k.length;a<d;a++)g.SEGMENT(b,0,k[a].segment),b+=k[a].length;return g.SEGMENT()},get:function(a){for(var d=[],c=0,b=k.length;c<b;c++)k[c].app===a.toUpperCase()&&d.push(k[c].segment);return d},
set:function(a,d){var c=[];"string"===typeof d?c.push(d):c=d;for(var b=ii=0,f=k.length;b<f&&!(k[b].app===a.toUpperCase()&&(k[b].segment=c[ii],k[b].length=c[ii].length,ii++),ii>=c.length);b++);},purge:function(){k=[];g.init(null)}}}}function H(){function f(a,d){var q=e.SHORT(a),m,c,k,h,l,j=[],n={};for(m=0;m<q;m++)if(l=a+12*m+2,k=d[e.SHORT(l)],k!==p){c=e.SHORT(l+=2);h=e.LONG(l+=2);l+=4;j=[];switch(c){case 1:case 7:4<h&&(l=e.LONG(l)+g.tiffHeader);for(c=0;c<h;c++)j[c]=e.BYTE(l+c);break;case 2:4<h&&(l=
e.LONG(l)+g.tiffHeader);n[k]=e.STRING(l,h-1);continue;case 3:2<h&&(l=e.LONG(l)+g.tiffHeader);for(c=0;c<h;c++)j[c]=e.SHORT(l+2*c);break;case 4:1<h&&(l=e.LONG(l)+g.tiffHeader);for(c=0;c<h;c++)j[c]=e.LONG(l+4*c);break;case 5:l=e.LONG(l)+g.tiffHeader;for(c=0;c<h;c++)j[c]=e.LONG(l+4*c)/e.LONG(l+4*c+4);break;case 9:l=e.LONG(l)+g.tiffHeader;for(c=0;c<h;c++)j[c]=e.SLONG(l+4*c);break;case 10:l=e.LONG(l)+g.tiffHeader;for(c=0;c<h;c++)j[c]=e.SLONG(l+4*c)/e.SLONG(l+4*c+4);break;default:continue}h=1==h?j[0]:j;
n[k]=b.hasOwnProperty(k)&&"object"!=typeof h?b[k][h]:h}return n}var e,k,g={},b;e=new C;k={tiff:{274:"Orientation",34665:"ExifIFDPointer",34853:"GPSInfoIFDPointer"},exif:{36864:"ExifVersion",40961:"ColorSpace",40962:"PixelXDimension",40963:"PixelYDimension",36867:"DateTimeOriginal",33434:"ExposureTime",33437:"FNumber",34855:"ISOSpeedRatings",37377:"ShutterSpeedValue",37378:"ApertureValue",37383:"MeteringMode",37384:"LightSource",37385:"Flash",41986:"ExposureMode",41987:"WhiteBalance",41990:"SceneCaptureType",
41988:"DigitalZoomRatio",41992:"Contrast",41993:"Saturation",41994:"Sharpness"},gps:{"0":"GPSVersionID",1:"GPSLatitudeRef",2:"GPSLatitude",3:"GPSLongitudeRef",4:"GPSLongitude"}};b={ColorSpace:{1:"sRGB","0":"Uncalibrated"},MeteringMode:{"0":"Unknown",1:"Average",2:"CenterWeightedAverage",3:"Spot",4:"MultiSpot",5:"Pattern",6:"Partial",255:"Other"},LightSource:{1:"Daylight",2:"Fliorescent",3:"Tungsten",4:"Flash",9:"Fine weather",10:"Cloudy weather",11:"Shade",12:"Daylight fluorescent (D 5700 - 7100K)",
13:"Day white fluorescent (N 4600 -5400K)",14:"Cool white fluorescent (W 3900 - 4500K)",15:"White fluorescent (WW 3200 - 3700K)",17:"Standard light A",18:"Standard light B",19:"Standard light C",20:"D55",21:"D65",22:"D75",23:"D50",24:"ISO studio tungsten",255:"Other"},Flash:{"0":"Flash did not fire.",1:"Flash fired.",5:"Strobe return light not detected.",7:"Strobe return light detected.",9:"Flash fired, compulsory flash mode",13:"Flash fired, compulsory flash mode, return light not detected",15:"Flash fired, compulsory flash mode, return light detected",
16:"Flash did not fire, compulsory flash mode",24:"Flash did not fire, auto mode",25:"Flash fired, auto mode",29:"Flash fired, auto mode, return light not detected",31:"Flash fired, auto mode, return light detected",32:"No flash function",65:"Flash fired, red-eye reduction mode",69:"Flash fired, red-eye reduction mode, return light not detected",71:"Flash fired, red-eye reduction mode, return light detected",73:"Flash fired, compulsory flash mode, red-eye reduction mode",77:"Flash fired, compulsory flash mode, red-eye reduction mode, return light not detected",
79:"Flash fired, compulsory flash mode, red-eye reduction mode, return light detected",89:"Flash fired, auto mode, red-eye reduction mode",93:"Flash fired, auto mode, return light not detected, red-eye reduction mode",95:"Flash fired, auto mode, return light detected, red-eye reduction mode"},ExposureMode:{"0":"Auto exposure",1:"Manual exposure",2:"Auto bracket"},WhiteBalance:{"0":"Auto white balance",1:"Manual white balance"},SceneCaptureType:{"0":"Standard",1:"Landscape",2:"Portrait",3:"Night scene"},
Contrast:{"0":"Normal",1:"Soft",2:"Hard"},Saturation:{"0":"Normal",1:"Low saturation",2:"High saturation"},Sharpness:{"0":"Normal",1:"Soft",2:"Hard"},GPSLatitudeRef:{N:"North latitude",S:"South latitude"},GPSLongitudeRef:{E:"East longitude",W:"West longitude"}};return{init:function(a){g={tiffHeader:10};if(a===p||!a.length)return!1;e.init(a);return 65505===e.SHORT(0)&&"EXIF\x00"===e.STRING(4,5).toUpperCase()?(a=p,a=g.tiffHeader,e.II(18761==e.SHORT(a)),42!==e.SHORT(a+=2)?a=!1:(g.IFD0=g.tiffHeader+e.LONG(a+
2),a=f(g.IFD0,k.tiff),g.exifIFD="ExifIFDPointer"in a?g.tiffHeader+a.ExifIFDPointer:p,g.gpsIFD="GPSInfoIFDPointer"in a?g.tiffHeader+a.GPSInfoIFDPointer:p,a=!0),a):!1},EXIF:function(){var a;a=f(g.exifIFD,k.exif);a.ExifVersion&&(a.ExifVersion=String.fromCharCode(a.ExifVersion[0],a.ExifVersion[1],a.ExifVersion[2],a.ExifVersion[3]));return a},GPS:function(){var a;a=f(g.gpsIFD,k.gps);a.GPSVersionID&&(a.GPSVersionID=a.GPSVersionID.join("."));return a},setExif:function(a,d){if("PixelXDimension"!==a&&"PixelYDimension"!==
a)return!1;var b;b=a;var f,c,h,j=0;if("string"===typeof b)for(hex in f=k.exif,f)if(f[hex]===b){b=hex;break}f=g.exifIFD;c=e.SHORT(f);for(i=0;i<c;i++)if(h=f+12*i+2,e.SHORT(h)==b){j=h+8;break}j?(e.LONG(j,d),b=!0):b=!1;return b},getBinary:function(){return e.SEGMENT()}}}var y={},F;f.runtimes.Html5=f.addRuntime("html5",{getFeatures:function(){var h,e,k,g,b,a;e=k=b=a=!1;s.XMLHttpRequest&&(h=new XMLHttpRequest,k=!!h.upload,e=!(!h.sendAsBinary&&!h.upload));e&&(g=!!(h.sendAsBinary||s.Uint8Array&&s.ArrayBuffer),
b=!(!File||!File.prototype.getAsDataURL&&!s.FileReader||!g),a=!(!File||!File.prototype.mozSlice&&!File.prototype.webkitSlice&&!File.prototype.slice));F=f.ua.safari&&f.ua.windows&&navigator.userAgent&&0<navigator.userAgent.indexOf("Version/4");h=e;e=j.createElement("div");return{html5:h,dragdrop:"draggable"in e||"ondragstart"in e&&"ondrop"in e,jpgresize:b,pngresize:b,multipart:b||!!s.FileReader||!!s.FormData,canSendBinary:g,cantSendBlobInFormData:!(!f.ua.gecko||!s.FormData||!s.FileReader||FileReader.prototype.readAsArrayBuffer),
progress:k,chunks:a,multi_selection:!(f.ua.safari&&f.ua.windows),triggerDialog:f.ua.gecko&&s.FormData||f.ua.webkit||f.ua.windows}},init:function(h,e){function k(a){var d,b,g=[],c,e={};for(b=0;b<a.length;b++)d=a[b],e[d.name]||(e[d.name]=!0,c=f.guid(),y[c]=d,c=new f.File(c,d.fileName||d.name,d.fileSize||d.size),c.nativeFile=d,g.push(c));g.length&&h.trigger("FilesAdded",g)}var g,b;g=this.getFeatures();g.html5?(h.upload=function(a){k(a)},h.bind("Init",function(a){var d,b,g=[],c,e,t=a.settings.filters,
l,s;c=j.body;var n;d=j.createElement("div");d.id=a.id+"_html5_container";f.extend(d.style,{position:"absolute",background:h.settings.shim_bgcolor||"transparent",width:"100px",height:"100px",overflow:"hidden",zIndex:99999,opacity:h.settings.shim_bgcolor?"":0});d.className="plupload html5";h.settings.container&&(c=j.getElementById(h.settings.container),"static"===f.getStyle(c,"position")&&(c.style.position="relative"));c.appendChild(d);c=0;a:for(;c<t.length;c++){l=t[c].extensions.split(/,/);for(e=0;e<
l.length;e++){if("*"===l[e]){g=[];break a}(s=f.mimeTypes[l[e]])&&g.push(s)}}d.innerHTML='<input id="'+h.id+'_html5"  style="font-size:999px" type="file" accept="'+g.join(",")+'" '+(h.settings.multi_selection&&h.features.multi_selection?'multiple="multiple"':"")+" />";d.scrollTop=100;n=j.getElementById(h.id+"_html5");h.settings.inputFileClazz&&(n.className+=" "+h.settings.inputFileClazz);a.features.triggerDialog?f.extend(n.style,{position:"absolute",width:"100%",height:"100%"}):f.extend(n.style,{cssFloat:"right",
styleFloat:"right"});var p=function(){k(this.files);if(navigator.appVersion.indexOf("MSIE10")===-1){n=this.cloneNode(true);n.onchange=p;this.parentNode.replaceChild(n,this)}else this.value=""};n.onchange=p;if(b="string"===typeof a.settings.browse_button?j.getElementById(a.settings.browse_button):a.settings.browse_button){var o=a.settings.browse_button_hover,B=a.settings.browse_button_active;d=a.features.triggerDialog?b:d;o&&(f.addEvent(d,"mouseover",function(){f.addClass(b,o)},a.id),f.addEvent(d,
"mouseout",function(){f.removeClass(b,o)},a.id));B&&(f.addEvent(d,"mousedown",function(){f.addClass(b,B)},a.id),f.addEvent(j.body,"mouseup",function(){f.removeClass(b,B)},a.id));a.features.triggerDialog&&f.addEvent(b,"click",function(b){j.getElementById(a.id+"_html5").click();b.preventDefault()},a.id)}}),h.bind("PostInit",function(){var a=f.getElement(h.settings.drop_element),b,e=!1;a&&(F?(f.addEvent(a,"dragenter",function(){var b,d;b=j.getElementById(h.id+"_drop");b||(b=j.createElement("input"),
b.setAttribute("type","file"),b.setAttribute("id",h.id+"_drop"),b.setAttribute("multiple","multiple"),f.addEvent(b,"change",function(){k(this.files);f.removeEvent(b,"change",h.id);b.parentNode.removeChild(b)},h.id),a.appendChild(b),e=!0);f.getPos(a,j.getElementById(h.settings.container));d=f.getSize(a);"static"===f.getStyle(a,"position")&&f.extend(a.style,{position:"relative"});f.extend(b.style,{position:"absolute",display:"block",top:0,left:0,width:d.w+"px",height:d.h+"px",opacity:0})},h.id),f.addEvent(a,
"dragleave",function(){e||(b&&b.parentElement.removeChild(b),b=null);e=!1})):(f.addEvent(a,"dragover",function(a){a.preventDefault()},h.id),f.addEvent(a,"drop",function(a){if(!$(".disable-attachment-uploader").length){var c=a.dataTransfer;c&&c.files&&k(c.files)}b&&b.parentElement.removeChild(b);b=null;a.preventDefault();h.settings.stop_propagation&&(a.cancelBubble?a.cancelBubble=!0:a.stopPropagation())},h.id)))}),h.bind("Refresh",function(a){var b,e,g;if(b=j.getElementById(h.settings.browse_button))e=
f.getPos(b,j.getElementById(a.settings.container)),g=f.getSize(b),a=j.getElementById(h.id+"_html5_container"),f.extend(a.style,{top:e.y+"px",left:e.x+"px",width:g.w+"px",height:g.h+"px"}),h.features.triggerDialog&&("static"===f.getStyle(b,"position")&&f.extend(b.style,{position:"relative"}),e=parseInt(f.getStyle(b,"z-index"),10),isNaN(e)&&(e=0),f.extend(b.style,{zIndex:e}),f.extend(a.style,{zIndex:e-1}))}),h.bind("CancelUpload",function(){b&&b.abort&&b.abort()}),h.bind("UploadFile",function(a,d){function e(c){function k(){function e(c){var h=
0,m="----pluploadboundary"+f.guid(),n,r="";b=new XMLHttpRequest;b.upload&&(b.upload.onprogress=function(b){d.loaded=Math.min(d.size,q+b.loaded-h);a.trigger("UploadProgress",d)});b.onreadystatechange=function(){var e,g;if(b.readyState==4){try{e=b.status}catch(h){e=0}if(e>=400)a.trigger("Error",{code:f.HTTP_ERROR,message:f.translate("HTTP Error."),file:d,status:e,xhr:b,response:b.responseText||""});else{if(p){g={chunk:j,chunks:p,response:b.responseText,status:e};a.trigger("ChunkUploaded",d,g);q=q+z;
if(g.cancelled){d.status=f.FAILED;return}d.loaded=Math.min(d.size,(j+1)*u)}else d.loaded=d.size;a.trigger("UploadProgress",d);c=o=n=r=null;if(!p||++j>=p){d.status=f.DONE;a.trigger("FileUploaded",d,{response:b.responseText,status:e})}else k()}}};if(a.settings.multipart&&g.multipart){x.name=d.target_name||d.name;b.open("post",D,!0);f.each(a.settings.headers,function(a,c){b.setRequestHeader(c,a)});if("string"!==typeof c&&s.FormData){n=new FormData;f.each(f.extend(x,a.settings.multipart_params),function(a,
b){n.append(b,a)});n.append(a.settings.file_data_name,c);b.send(n);return}if("string"===typeof c){b.setRequestHeader("Content-Type","multipart/form-data; boundary="+m);f.each(f.extend(x,a.settings.multipart_params),function(a,b){r=r+("--"+m+'\r\nContent-Disposition: form-data; name="'+b+'"\r\n\r\n');r=r+(unescape(encodeURIComponent(a))+"\r\n")});y=f.mimeTypes[d.name.replace(/^.+\.([^.]+)/,"$1").toLowerCase()]||"application/octet-stream";r+="--"+m+'\r\nContent-Disposition: form-data; name="'+a.settings.file_data_name+
'"; filename="'+unescape(encodeURIComponent(d.name))+'"\r\nContent-Type: '+y+"\r\n\r\n"+c+"\r\n--"+m+"--\r\n";h=r.length-c.length;c=r;if(b.sendAsBinary)b.sendAsBinary(c);else if(g.canSendBinary){for(var w=new Uint8Array(c.length),v=0;v<c.length;v++)w[v]=c.charCodeAt(v)&255;b.send(w.buffer)}return}}D=f.buildUrl(a.settings.url,f.extend(x,a.settings.multipart_params));b.open("post",D,!0);b.setRequestHeader("Content-Type","application/octet-stream");c.encoding&&b.setRequestHeader("Content-Encoding",c.encoding);
f.each(a.settings.headers,function(a,c){b.setRequestHeader(c,a)});b.send(c.getData?c.getData():c)}var o,p,x,u,z,y,D=a.settings.url;if(!(d.status==f.DONE||d.status==f.FAILED||a.state==f.STOPPED)){x={name:d.target_name||d.name};if(h.chunk_size&&d.size>h.chunk_size&&(g.chunks||"string"==typeof c)){u=h.chunk_size;p=Math.ceil(d.size/u);z=Math.min(u,d.size-j*u);if("string"==typeof c)o=c.substring(j*u,j*u+z);else{var v=c,A=j*u,E=j*u+z,w;if(File.prototype.slice)try{v.slice(),o=v.slice(A,E)}catch(C){o=v.slice(A,
E-A)}else o=(w=File.prototype.webkitSlice||File.prototype.mozSlice)?w.call(v,A,E):null}x.chunk=j;x.chunks=p}else z=d.size,o=c;"string"!==typeof o&&n&&g.cantSendBlobInFormData&&g.chunks&&a.settings.chunk_size?(n.onload=function(){e(n.result)},n.readAsBinaryString(o)):e(o)}}var j=0,q=0,n="FileReader"in s?new FileReader:null;k()}var h=a.settings,c;c=y[d.id];g.jpgresize&&a.settings.resize&&/\.(png|jpg|jpeg)$/i.test(d.name)?G.call(a,d,a.settings.resize,/\.png$/i.test(d.name)?"image/png":"image/jpeg",function(a){a.success?
(d.size=a.data.length,e(a.data)):e(c)}):e(c)}),h.bind("Destroy",function(a){var b,e,g=j.body,c={inputContainer:a.id+"_html5_container",inputFile:a.id+"_html5",browseButton:a.settings.browse_button,dropElm:a.settings.drop_element};for(b in c)(e=j.getElementById(c[b]))&&f.removeAllEvents(e,a.id);f.removeAllEvents(j.body,a.id);a.settings.container&&(g=j.getElementById(a.settings.container));g.removeChild(j.getElementById(c.inputContainer))}),e({success:!0})):e({success:!1})}})})(window,document,plupload);