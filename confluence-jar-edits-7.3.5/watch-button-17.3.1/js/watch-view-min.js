define("confluence-watch-button/watch-view",["jquery","ajs","underscore","backbone","confluence/flag"],function(c,a,b,e,d){return e.View.extend({events:{"change #cw-watch-page":"changeWatchPage","change #cw-watch-blogs":"changeWatchBlogs","change #cw-watch-space":"changeWatchSpace"},initialize:function(){b.bindAll(this,"render","initTooltips","changeWatchPage","changeWatchBlogs","changeWatchSpace","togglePageEnabledState","toggleBlogsEnabledState","startLoading","stopLoading","setTitle","_restoreCheckboxState","_disableAllElements","_rememberLastState","_revertToLastState");this.model.on("sync change:watchingSpace",this.togglePageEnabledState,this);this.model.on("change:watchingSpace",this.toggleBlogsEnabledState,this);this.model.on("request",this.startLoading,this);this.model.on("sync",this.setTitle,this);this.model.on("sync",this.stopLoading,this);this.model.on("sync",this._restoreCheckboxState,this);this.model.on("error",this._revertToLastState,this)},render:function(){this.$el.html(Confluence.Watch.Templates.dialogBody(this.model.toJSON()));this.initTooltips();this.setTitle(this.model);if(a.Meta.get("access-mode")==="READ_ONLY"){this._disableAllElements()}return this},_revertToLastState:function(){var i=this.currentModel.get("watchingPage");var j=this.currentModel.get("watchingSpace");var k=this.currentModel.get("watchingBlogs");var f=this.$("#cw-watch-page");f.prop("checked",i||j);f.prop("disabled",this.currentModel.get("watchPageDisabled"));var h=this.$("#cw-watch-space");h.prop("checked",j);h.prop("disabled",this.currentModel.get("watchSpaceDisabled"));var l=this.$("#cw-watch-blogs");l.prop("checked",k);l.prop("disabled",this.currentModel.get("watchBlogsDisabled"));this.$(".cw-manage-watchers").removeClass("disabled");this.model.set("watchingPage",i);this.model.set("watchingBlogs",k);this.model.set("watchingSpace",j);this.stopLoading();var g={close:"manual",type:"error",extraClasses:"confluence-menu-flag",fifo:true,stack:"menu"};this.errorFlag=new d(c.extend({},g,{body:a.I18n.getText("read.only.mode.default.error.short.message")}))},_rememberLastState:function(){if(!!this.errorFlag){this.errorFlag.close()}this.currentModel=this.model.clone();this.currentModel.set("watchPageDisabled",this.$("#cw-watch-page").prop("disabled"));this.currentModel.set("watchSpaceDisabled",this.$("#cw-watch-space").prop("disabled"));this.currentModel.set("watchBlogsDisabled",this.$("#cw-watch-blogs").prop("disabled"));this.$targetCheckbox.prop("disabled",true)},_disableAllElements:function(){this.$("input[type='checkbox']").prop("disabled",true);this.$(".cw-manage-watchers").addClass("disabled")},_restoreCheckboxState:function(){this.$targetCheckbox&&this.$targetCheckbox.prop("disabled",false)},initTooltips:function(){this.$(".cw-tooltip").tooltip({gravity:"e",offset:5,delayIn:0});this.togglePageEnabledState(this.model);this.toggleBlogsEnabledState(this.model)},changeWatchPage:function(g){this.$targetCheckbox=c(g.target);this._rememberLastState();var f=this.$targetCheckbox.is(":checked");this.model.saveWatchPage(f)},changeWatchBlogs:function(g){this.$targetCheckbox=c(g.target);this._rememberLastState();var f=this.$targetCheckbox.is(":checked");this.model.saveWatchBlogs(f)},changeWatchSpace:function(g){this.$targetCheckbox=c(g.target);this._rememberLastState();var f=this.$targetCheckbox.is(":checked");this.model.saveWatchSpace(f)},togglePageEnabledState:function(f){var g=f.get("watchingPage");var i=f.get("watchingSpace");this.$("#cw-watch-page").prop("disabled",i);this.$("#cw-watch-page").prop("checked",g||i);var h=i?a.I18n.getText("confluence.watch.disabledpage.tooltip"):"";this.$(".cw-tooltip-watch-page").attr("original-title",h)},toggleBlogsEnabledState:function(f){var i=f.get("watchingBlogs");var h=f.get("watchingSpace");this.$("#cw-watch-blogs").prop("disabled",h);this.$("#cw-watch-blogs").prop("checked",i||h);var g=h?a.I18n.getText("confluence.watch.disabledblogs.tooltip"):"";this.$(".cw-tooltip-watch-blogs").attr("original-title",g)},startLoading:function(){this.$(".cw-status").addClass("loading")},stopLoading:function(){this.$(".cw-status").removeClass("loading")},setTitle:function(){var g=this.model.get("watchingPage");var k=this.model.get("watchingBlogs");var i=this.model.get("watchingSpace");var f=this.model.get("isBlogPost");function j(){if(i){return{title:a.I18n.getText("confluence.watch.title.watching.space"),description:a.I18n.getText("confluence.watch.title.watching.space.description"),}}if(g&&f&&k){return{title:a.I18n.getText("confluence.watch.title.watching.blog.and.blogs"),description:a.I18n.getText("confluence.watch.title.watching.blog.and.blogs.description"),}}if(g&&f){return{title:a.I18n.getText("confluence.watch.title.watching.blog"),description:a.I18n.getText("confluence.watch.title.watching.blog.description"),}}if(g){return{title:a.I18n.getText("confluence.watch.title.watching.page"),description:a.I18n.getText("confluence.watch.title.watching.page.description"),}}if(f&&k){return{title:a.I18n.getText("confluence.watch.title.watching.blogs"),description:a.I18n.getText("confluence.watch.title.watching.blogs.description"),}}if(f){return{title:a.I18n.getText("confluence.watch.title.watching.nothing.blog"),description:a.I18n.getText("confluence.watch.title.watching.nothing.blog.description"),}}return{title:a.I18n.getText("confluence.watch.title.watching.nothing.page"),description:a.I18n.getText("confluence.watch.title.watching.nothing.page.description"),}}var h=j();this.$(".cw-title").text(h.title);this.$(".cw-title-description").text(h.description)}})});