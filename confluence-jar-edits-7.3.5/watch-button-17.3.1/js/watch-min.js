require(["jquery","underscore","ajs","confluence-watch-button/watch-model","confluence-watch-button/watch-view","confluence-watch-button/watch-notification"],function(t,n,e,a,c,o){function i(t,n){var a=n.watchingPage,c=n.isBlogPost&&n.watchingBlogs,o=n.watchingSpace;if(a||c||o){var i=t.find(".aui-icon").removeClass("aui-iconfont-unwatch").addClass("aui-iconfont-watch"),g=e.I18n.getText("confluence.watch.stop.button","<u>","</u>");t.prop("title",e.I18n.getText("confluence.watch.stop.button.tooltip")).children("span").empty().append(i).append(" "+g)}else{i=t.find(".aui-icon").removeClass("aui-iconfont-watch").addClass("aui-iconfont-unwatch");var h=e.I18n.getText("confluence.watch.start.button","<u>","</u>");t.prop("title",e.I18n.getText("confluence.watch.start.button.tooltip")).children("span").empty().append(i).append(" "+h)}}e.toInit(function(){var g=t("#watch-content-button");if(g.length){g.click(function(n){n.preventDefault(),t("#watch-title").focus()}),g.keyup(function(n){13===event.keyCode&&t(this).click()});var h=e.Meta.get("page-id");t.getJSON(e.contextPath()+"/rest/watch-button/1.0/watchState/"+h,function(u){n.extend(u,{pageId:h,spaceKey:e.Meta.get("space-key"),spaceName:e.Meta.get("space-name")}),function(n,g){i(n,g);var h=new a(g),u=new c({model:h});e.InlineDialog(n,"confluence-watch",function(t,n,e){u.setElement(t),u.render(),e()},{width:325,offsetX:-180,cacheContent:!1,hideDelay:null,hideCallback:function(){t(".tipsy").hide()}}),h.on("change:watchingPage change:watchingBlogs change:watchingSpace",function(t){i(n,t.toJSON())}),h.on("change:watchingPage",function(t,n){var a=n?"watch-page":"unwatch-page";e.trigger("analytics",{name:a})}),h.on("change:watchingBlogs",function(t,n){var a=n?"watch-blogs":"unwatch-blogs";e.trigger("analytics",{name:a})}),h.on("change:watchingSpace",function(t,n){var a=n?"watch-space":"unwatch-space";e.trigger("analytics",{name:a})}),w=h,w.on("change:watchingPage",function(t,n){var a=n?"watchpage.pageoperation":"unwatchpage.pageoperation";e.trigger(a)});var w;var l=!1;t(document).on("keyup",function(){l=!1}),window.CW_watchPage=function(){if(!l){l=!0;var a=h.get("watchingSpace"),c=h.get("watchingPage");if(a)t("body, #splitter-content").animate({scrollTop:0},300,function(){n.click(),setTimeout(function(){t(".cw-tooltip-watch-page").tipsy("show")},50)});else{var i=!c;h.saveWatchPage(i);var g=i?e.I18n.getText("confluence.watch.notification.start.watching.page"):e.I18n.getText("confluence.watch.notification.stop.watching.page");o(g)}}}}(g,u),g.addClass("watch-state-initialised")})}})});