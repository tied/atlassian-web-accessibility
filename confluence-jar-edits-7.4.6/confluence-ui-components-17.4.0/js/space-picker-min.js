define("confluence-ui-components/js/space-picker",["underscore","ajs","jquery","confluence-ui-components/js/internal/space-resolver"],function(r,f,b,d){var a={data:null,suggestCategories:null};var p=function(s){return function(t){var u={id:t.spaceKey,text:t.spaceName};if(typeof s==="function"){return s(u)}return u}};var k;var c=function(s){return function(t,x){var w=b(t).val();if(w===""){return}var u=w.split(",");function v(y){if(!s.multiple){y=y[0]}x(y)}d.getSpaceDisplayItems(u,v)}};var e=function(t){var s;if(t.suggestCategories){var u={text:f.I18n.getText("confluence-ui-components.space-picker.select.or.type"),children:r.map(t.suggestCategories,function(v){return{id:v,text:d.getSpaceCategoryDisplayName(v)}})}}return function(w){if(s){w.callback(s);return}function v(x){var y={results:[]};if(u){y.results.push(u)}if(x.length>0){y.results.push({text:f.I18n.getText("confluence-ui-components.space-picker.suggested-spaces"),children:r.map(x,function(z){return{id:z.key,text:r.escape(z.name)}})})}s=y;w.callback(s)}b.getJSON(f.contextPath()+"/rest/recentlyviewed/1.0/recent/spaces").done(v).fail(function(){f.log("Couldn't fetch recent spaces");var x={results:[]};if(u){x.results.push(u)}w.callback(x)})}};var n=function(){return window.Select2.query.ajax({url:f.contextPath()+"/rest/quicknav/1/search?type=spacedesc&type=personalspacedesc",data:function(s){return{query:s,maxPerCategory:25}},quietMillis:250,results:function(u){var t=u.contentNameMatches;if(t.length<=1){return{results:[]}}else{var s=r.map(t[0],k);return{results:[{text:f.I18n.getText("confluence-ui-components.space-picker.search-results"),children:s}]}}}})};function g(t){var s=n();var u=e(t);return function(v,x,w){if(v.term.length<2){return u(v)}else{if(typeof x==="function"){v.term=x(v.term)}k=p(w);return s(v)}}}function h(){var s=b(".select2-container-active").next("input");var t=s.val().trim();return(t!=="")?t.split(","):[]}function i(s){var t=r.intersection(s,d.getSpaceTypeKeys());return t.length>0}function j(s){return(typeof s.id!=="undefined")&&r.contains(d.getSpaceTypeKeys(),s.id)}function q(t,u,v){var s=[];t.forEach(function(w){if(w.children){var x=q(w.children,u,v);if(x.length){s.push(b.extend({},w,{children:x}))}}else{var y=j(w);if((u&&y)||(!u&&!y)){if(!r.contains(v,w.id)){s.push(w)}}}});return s}function m(t,v){if(!t.length||!v.length){return t}var u=i(v);var s=q(t,u,v);if(!s.length){s.push({text:f.I18n.getText("confluence-ui-components.space-picker.no.results.after.filter"),disabled:true})}return s}function o(s){var t=h();return m(s,t)}function l(t){t=r.extend({},a,t);var s={placeholder:f.I18n.getText("confluence-ui-components.space-picker.placeholder"),formatResult:function(u,v,w){v.attr("title",b("<div/>").html(u.text).text());return b.fn.select2.defaults.formatResult.apply(this,arguments)},escapeMarkup:function(u){return u},multiple:t.multiple===true};if(t.disableMixedSpaceTypes){s.sortResults=o}if(t.data){return r.extend(s,{data:t.data})}else{return r.extend(s,{initSelection:c(t),query:g(t)})}}return{build:l,filterMixedTypesForValues:m}});